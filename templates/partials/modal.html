<!-- Reusable Modal Component -->
<!-- Usage: {% include 'partials/modal.html' with modal_id='confirmDelete' modal_title='Confirm Deletion' modal_body='Are you sure?' %} -->

<div class="modal fade" id="{{ modal_id|default:'defaultModal' }}" tabindex="-1" 
     aria-labelledby="{{ modal_id|default:'defaultModal' }}Label" aria-hidden="true" 
     role="dialog" aria-modal="true">
    <div class="modal-dialog {{ modal_size|default:'' }}">
        <div class="modal-content">
            {% if modal_title %}
            <div class="modal-header">
                <h5 class="modal-title" id="{{ modal_id|default:'defaultModal' }}Label">
                    {% if modal_icon %}<i class="{{ modal_icon }} me-2"></i>{% endif %}
                    {{ modal_title }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" 
                        aria-label="Close dialog"></button>
            </div>
            {% endif %}
            
            <div class="modal-body">
                {% if modal_body %}
                    {{ modal_body|safe }}
                {% else %}
                    {% block modal_content %}
                    <!-- Modal content goes here -->
                    {% endblock %}
                {% endif %}
            </div>
            
            {% if modal_show_footer|default:True %}
            <div class="modal-footer">
                {% if modal_footer_content %}
                    {{ modal_footer_content|safe }}
                {% else %}
                    {% block modal_footer %}
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Cancel
                    </button>
                    {% if modal_confirm_action %}
                    <button type="button" class="btn btn-{{ modal_confirm_type|default:'primary' }}" 
                            onclick="{{ modal_confirm_action }}">
                        {% if modal_confirm_icon %}<i class="{{ modal_confirm_icon }} me-1"></i>{% endif %}
                        {{ modal_confirm_text|default:'Confirm' }}
                    </button>
                    {% endif %}
                    {% endblock %}
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Enhanced Modal Styles -->
<style>
.modal-dialog {
    margin: 1.75rem auto;
}

.modal-content {
    border: none;
    border-radius: 12px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    animation: modalSlideIn 0.3s ease-out;
}

[data-bs-theme="dark"] .modal-content {
    background-color: #1f2937;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
}

.modal-header {
    border-bottom: 1px solid #e5e7eb;
    padding: 1rem 1.5rem;
}

[data-bs-theme="dark"] .modal-header {
    border-bottom-color: #374151;
}

.modal-title {
    font-weight: 600;
    font-size: 1.125rem;
    color: #1f2937;
}

[data-bs-theme="dark"] .modal-title {
    color: #f9fafb;
}

.modal-body {
    padding: 1.5rem;
    color: #4b5563;
}

[data-bs-theme="dark"] .modal-body {
    color: #d1d5db;
}

.modal-footer {
    border-top: 1px solid #e5e7eb;
    padding: 1rem 1.5rem;
    gap: 0.5rem;
}

[data-bs-theme="dark"] .modal-footer {
    border-top-color: #374151;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: scale(0.95) translateY(-20px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.modal-backdrop {
    backdrop-filter: blur(3px);
}
</style>

<!-- Modal JavaScript Enhancement -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enhanced modal behavior
    const modals = document.querySelectorAll('.modal');
    
    modals.forEach(modal => {
        // Focus management
        modal.addEventListener('shown.bs.modal', function() {
            const focusableElement = modal.querySelector('input, button, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (focusableElement) {
                focusableElement.focus();
            }
        });
        
        // Keyboard navigation
        modal.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                bootstrap.Modal.getInstance(modal)?.hide();
            }
            
            // Tab trapping
            if (e.key === 'Tab') {
                const focusableElements = modal.querySelectorAll(
                    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                );
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];
                
                if (e.shiftKey) {
                    if (document.activeElement === firstElement) {
                        e.preventDefault();
                        lastElement.focus();
                    }
                } else {
                    if (document.activeElement === lastElement) {
                        e.preventDefault();
                        firstElement.focus();
                    }
                }
            }
        });
    });
});

// Helper function to show confirmation modal
function showConfirmDialog(title, message, onConfirm, confirmText = 'Confirm', confirmType = 'danger') {
    const modalId = 'confirmDialog';
    let existingModal = document.getElementById(modalId);
    
    if (existingModal) {
        existingModal.remove();
    }
    
    const modalHtml = `
        <div class="modal fade" id="${modalId}" tabindex="-1" aria-hidden="true" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                            ${title}
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        ${message}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle me-1"></i>Cancel
                        </button>
                        <button type="button" class="btn btn-${confirmType}" id="confirmButton">
                            <i class="bi bi-check-circle me-1"></i>${confirmText}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = new bootstrap.Modal(document.getElementById(modalId));
    
    document.getElementById('confirmButton').addEventListener('click', function() {
        onConfirm();
        modal.hide();
    });
    
    modal.show();
    
    // Clean up after modal is hidden
    document.getElementById(modalId).addEventListener('hidden.bs.modal', function() {
        this.remove();
    });
}

// Export for global use
window.showConfirmDialog = showConfirmDialog;
</script> 