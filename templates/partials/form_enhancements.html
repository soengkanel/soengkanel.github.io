<!-- Form Enhancement Component -->
<!-- Include this in any template with forms to add enhanced validation and UX -->

<style>
/* Enhanced Form Styling */
.form-group {
    position: relative;
    margin-bottom: 1rem;
}

.form-label {
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.375rem;
    display: block;
}

[data-bs-theme="dark"] .form-label {
    color: #d1d5db;
}

.form-label.required::after {
    content: ' *';
    color: #dc3545;
}

.form-control {
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.form-control:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
}

.form-control.is-valid {
    border-color: #10b981;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%2310b981' d='m2.3 6.73.4.39 3.4-3.14-.79-.78L3.46 5.05l-.78-.78-.78.78z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.form-control.is-invalid {
    border-color: #ef4444;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23ef4444'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 4.6 2.4 2.4M8.2 4.6l-2.4 2.4'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.valid-feedback {
    display: block;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875em;
    color: #10b981;
}

.invalid-feedback {
    display: block;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875em;
    color: #ef4444;
}

.form-help {
    font-size: 0.8rem;
    color: #6b7280;
    margin-top: 0.25rem;
}

[data-bs-theme="dark"] .form-help {
    color: #9ca3af;
}

/* Loading states for form fields */
.form-control.loading {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none'%3e%3ccircle cx='12' cy='12' r='10' stroke='%236b7280' stroke-width='2'/%3e%3cpath d='M12 2a10 10 0 0 1 10 10' stroke='%233b82f6' stroke-width='2' stroke-linecap='round'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    animation: spin 1s linear infinite;
}

/* Character counter */
.char-counter {
    font-size: 0.75rem;
    color: #6b7280;
    text-align: right;
    margin-top: 0.25rem;
}

.char-counter.warning {
    color: #f59e0b;
}

.char-counter.danger {
    color: #ef4444;
}

/* Password strength indicator */
.password-strength {
    height: 4px;
    background: #e5e7eb;
    border-radius: 2px;
    margin-top: 0.5rem;
}

.password-strength-bar {
    height: 100%;
    transition: width 0.3s ease, background-color 0.3s ease;
}

.password-strength.weak .password-strength-bar {
    width: 25%;
    background-color: #ef4444;
}

.password-strength.fair .password-strength-bar {
    width: 50%;
    background-color: #f59e0b;
}

.password-strength.good .password-strength-bar {
    width: 75%;
    background-color: #3b82f6;
}

.password-strength.strong .password-strength-bar {
    width: 100%;
    background-color: #10b981;
}

/* Form submission state */
.form-submitting {
    opacity: 0.6;
    pointer-events: none;
}

.form-submitting .btn[type="submit"] {
    position: relative;
}

.form-submitting .btn[type="submit"]::after {
    content: '';
    position: absolute;
    width: 16px;
    height: 16px;
    margin: auto;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enhanced form validation and UX
    class FormEnhancer {
        constructor(form) {
            this.form = form;
            this.init();
        }
        
        init() {
            this.addRealTimeValidation();
            this.addCharacterCounters();
            this.addPasswordStrength();
            this.preventDoubleSubmission();
            this.addAccessibilityFeatures();
        }
        
        addRealTimeValidation() {
            const inputs = this.form.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                // Validate on blur
                input.addEventListener('blur', () => {
                    this.validateField(input);
                });
                
                // Clear validation on input for better UX
                input.addEventListener('input', () => {
                    if (input.classList.contains('is-invalid')) {
                        this.clearFieldValidation(input);
                    }
                });
            });
        }
        
        validateField(field) {
            const value = field.value.trim();
            let isValid = true;
            let message = '';
            
            // Required field validation
            if (field.hasAttribute('required') && !value) {
                isValid = false;
                message = 'This field is required';
            }
            
            // Email validation
            if (field.type === 'email' && value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                    isValid = false;
                    message = 'Please enter a valid email address';
                }
            }
            
            // Phone validation
            if (field.type === 'tel' && value) {
                const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
                if (!phoneRegex.test(value.replace(/[\s\-\(\)]/g, ''))) {
                    isValid = false;
                    message = 'Please enter a valid phone number';
                }
            }
            
            // Min length validation
            if (field.hasAttribute('minlength') && value.length < parseInt(field.getAttribute('minlength'))) {
                isValid = false;
                message = `Minimum ${field.getAttribute('minlength')} characters required`;
            }
            
            // Max length validation
            if (field.hasAttribute('maxlength') && value.length > parseInt(field.getAttribute('maxlength'))) {
                isValid = false;
                message = `Maximum ${field.getAttribute('maxlength')} characters allowed`;
            }
            
            this.setFieldValidation(field, isValid, message);
        }
        
        setFieldValidation(field, isValid, message) {
            field.classList.remove('is-valid', 'is-invalid');
            
            // Remove existing feedback
            const existingFeedback = field.parentNode.querySelector('.valid-feedback, .invalid-feedback');
            if (existingFeedback) {
                existingFeedback.remove();
            }
            
            if (isValid && field.value.trim()) {
                field.classList.add('is-valid');
                this.addFeedback(field, 'valid-feedback', 'Looks good!');
            } else if (!isValid) {
                field.classList.add('is-invalid');
                this.addFeedback(field, 'invalid-feedback', message);
            }
        }
        
        clearFieldValidation(field) {
            field.classList.remove('is-valid', 'is-invalid');
            const feedback = field.parentNode.querySelector('.valid-feedback, .invalid-feedback');
            if (feedback) {
                feedback.remove();
            }
        }
        
        addFeedback(field, className, message) {
            const feedback = document.createElement('div');
            feedback.className = className;
            feedback.textContent = message;
            field.parentNode.appendChild(feedback);
        }
        
        addCharacterCounters() {
            const textareas = this.form.querySelectorAll('textarea[maxlength]');
            
            textareas.forEach(textarea => {
                const maxLength = parseInt(textarea.getAttribute('maxlength'));
                const counter = document.createElement('div');
                counter.className = 'char-counter';
                textarea.parentNode.appendChild(counter);
                
                const updateCounter = () => {
                    const remaining = maxLength - textarea.value.length;
                    counter.textContent = `${textarea.value.length}/${maxLength}`;
                    
                    counter.classList.remove('warning', 'danger');
                    if (remaining < maxLength * 0.1) {
                        counter.classList.add('danger');
                    } else if (remaining < maxLength * 0.2) {
                        counter.classList.add('warning');
                    }
                };
                
                textarea.addEventListener('input', updateCounter);
                updateCounter(); // Initial count
            });
        }
        
        addPasswordStrength() {
            const passwordFields = this.form.querySelectorAll('input[type="password"]');
            
            passwordFields.forEach(field => {
                if (!field.dataset.skipStrength) {
                    const strengthContainer = document.createElement('div');
                    strengthContainer.className = 'password-strength';
                    strengthContainer.innerHTML = '<div class="password-strength-bar"></div>';
                    field.parentNode.appendChild(strengthContainer);
                    
                    field.addEventListener('input', () => {
                        const strength = this.calculatePasswordStrength(field.value);
                        strengthContainer.className = `password-strength ${strength}`;
                    });
                }
            });
        }
        
        calculatePasswordStrength(password) {
            let score = 0;
            
            if (password.length >= 8) score++;
            if (/[a-z]/.test(password)) score++;
            if (/[A-Z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[^A-Za-z0-9]/.test(password)) score++;
            
            if (score <= 1) return 'weak';
            if (score <= 2) return 'fair';
            if (score <= 3) return 'good';
            return 'strong';
        }
        
        preventDoubleSubmission() {
            this.form.addEventListener('submit', (e) => {
                if (this.form.classList.contains('form-submitting')) {
                    e.preventDefault();
                    return false;
                }
                
                this.form.classList.add('form-submitting');
                
                // Re-enable after 10 seconds as fallback
                setTimeout(() => {
                    this.form.classList.remove('form-submitting');
                }, 10000);
            });
        }
        
        addAccessibilityFeatures() {
            // Add ARIA attributes
            const inputs = this.form.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                const label = this.form.querySelector(`label[for="${input.id}"]`);
                if (label && !input.getAttribute('aria-labelledby')) {
                    input.setAttribute('aria-labelledby', label.id || `${input.id}-label`);
                    if (!label.id) {
                        label.id = `${input.id}-label`;
                    }
                }
                
                // Add required indicator to label
                if (input.hasAttribute('required') && label) {
                    label.classList.add('required');
                }
                
                // Add describedby for help text
                const helpText = input.parentNode.querySelector('.form-help');
                if (helpText) {
                    const helpId = `${input.id}-help`;
                    helpText.id = helpId;
                    input.setAttribute('aria-describedby', helpId);
                }
            });
        }
    }
    
    // Auto-enhance all forms
    const forms = document.querySelectorAll('form:not([data-skip-enhancement])');
    forms.forEach(form => {
        new FormEnhancer(form);
    });
    
    // Export for manual enhancement
    window.FormEnhancer = FormEnhancer;
});

// Utility functions
function showFieldLoading(fieldId, show = true) {
    const field = document.getElementById(fieldId);
    if (field) {
        if (show) {
            field.classList.add('loading');
        } else {
            field.classList.remove('loading');
        }
    }
}

function setFieldError(fieldId, message) {
    const field = document.getElementById(fieldId);
    if (field) {
        field.classList.remove('is-valid');
        field.classList.add('is-invalid');
        
        const existingFeedback = field.parentNode.querySelector('.invalid-feedback');
        if (existingFeedback) {
            existingFeedback.textContent = message;
        } else {
            const feedback = document.createElement('div');
            feedback.className = 'invalid-feedback';
            feedback.textContent = message;
            field.parentNode.appendChild(feedback);
        }
    }
}

function clearFieldError(fieldId) {
    const field = document.getElementById(fieldId);
    if (field) {
        field.classList.remove('is-invalid');
        const feedback = field.parentNode.querySelector('.invalid-feedback');
        if (feedback) {
            feedback.remove();
        }
    }
}

// Export utility functions
window.showFieldLoading = showFieldLoading;
window.setFieldError = setFieldError;
window.clearFieldError = clearFieldError;
</script> 