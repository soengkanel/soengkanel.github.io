{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ course.title }}{% endblock %}


{% block extra_css %}
<style>
    .course-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }
    .module-card {
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        margin-bottom: 1rem;
        background: white;
    }
    .module-header {
        padding: 1rem;
        background: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
        cursor: pointer;
    }
    .lesson-item {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        justify-content: between;
        align-items: center;
    }
    .lesson-item:last-child {
        border-bottom: none;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    .stat-item {
        text-align: center;
        padding: 1rem;
        background: rgba(255,255,255,0.1);
        border-radius: 8px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-3">
    <!-- Back Button -->
    <div class="mb-3">
        <a href="{% url 'employee_portal:training_courses' %}" class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-arrow-left"></i> Back to Courses
        </a>
    </div>

    <!-- Course Header -->
    <div class="course-header">
        <div class="row">
            <div class="col-md-8">
                <div class="d-flex gap-2 mb-2">
                    <span class="badge bg-white text-primary">{{ course.get_category_display }}</span>
                    <span class="badge bg-white text-dark">{{ course.get_level_display }}</span>
                    {% if course.is_mandatory %}
                    <span class="badge bg-danger">Mandatory</span>
                    {% endif %}
                </div>
                <h3 class="mb-2">{{ course.title }}</h3>
                <p class="mb-3">{{ course.description|linebreaks }}</p>
                <div class="d-flex gap-4 text-white-50">
                    <span><i class="bi bi-clock me-1"></i> {{ course.duration_hours }} hours</span>
                    <span><i class="bi bi-person me-1"></i> {{ course.instructor }}</span>
                    <span><i class="bi bi-people me-1"></i> {{ total_enrolled }} enrolled</span>
                </div>
            </div>
            <div class="col-md-4 text-end">
                {% if is_enrolled %}
                <div class="alert alert-success mb-2">
                    <i class="bi bi-check-circle me-1"></i> You are enrolled
                </div>
                <a href="{% url 'training:learn_course' course.id %}" class="btn btn-light btn-lg w-100">
                    <i class="bi bi-play-circle me-2"></i> Continue Learning
                </a>
                {% if enrollment %}
                <div class="stats-grid mt-3">
                    <div class="stat-item">
                        <div style="font-size: 1.5rem; font-weight: bold;">{{ enrollment.progress_percentage }}%</div>
                        <div style="font-size: 0.75rem;">Progress</div>
                    </div>
                </div>
                {% endif %}
                {% else %}
                <a href="{% url 'employee_portal:training_enroll' course.id %}" class="btn btn-light btn-lg w-100">
                    <i class="bi bi-plus-circle me-2"></i> Enroll Now
                </a>
                <div class="stats-grid mt-3">
                    <div class="stat-item">
                        <div style="font-size: 1.5rem; font-weight: bold;">{{ course.passing_score }}%</div>
                        <div style="font-size: 0.75rem;">Passing Score</div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Course Content -->
    <div class="row">
        <div class="col-md-8">
            <h5 class="mb-3">Course Content</h5>
            {% if modules %}
            {% for module in modules %}
            <div class="module-card">
                <div class="module-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">{{ module.title }}</h6>
                            <small class="text-muted">{{ module.description }}</small>
                        </div>
                        <span class="badge bg-primary">{{ module.lesson_count }} lesson{{ module.lesson_count|pluralize }}</span>
                    </div>
                </div>
                <div class="module-content">
                    {% for lesson in module.lessons.all %}
                    <div class="lesson-item">
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-{% if lesson.content_type == 'video' %}play-circle{% elif lesson.content_type == 'quiz' %}question-circle{% else %}file-text{% endif %} me-2 text-primary"></i>
                                <span>{{ lesson.title }}</span>
                                {% if lesson.is_mandatory %}
                                <span class="badge bg-danger ms-2" style="font-size: 0.6rem;">Required</span>
                                {% endif %}
                            </div>
                        </div>
                        <small class="text-muted">{{ lesson.duration_minutes }} min</small>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i> Course content is being prepared.
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
            <!-- Course Info -->
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0">Course Information</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted d-block">Course Code</small>
                        <strong>{{ course.code }}</strong>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted d-block">Duration</small>
                        <strong>{{ course.duration_hours }} hours</strong>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted d-block">Level</small>
                        <strong>{{ course.get_level_display }}</strong>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted d-block">Category</small>
                        <strong>{{ course.get_category_display }}</strong>
                    </div>
                    {% if course.instructor %}
                    <div class="mb-3">
                        <small class="text-muted d-block">Instructor</small>
                        <strong>{{ course.instructor }}</strong>
                    </div>
                    {% endif %}
                    <div class="mb-3">
                        <small class="text-muted d-block">Students Enrolled</small>
                        <strong>{{ total_enrolled }}{% if course.max_students %} / {{ course.max_students }}{% endif %}</strong>
                    </div>
                    <div class="mb-0">
                        <small class="text-muted d-block">Completion Rate</small>
                        <strong>{{ course.completion_rate }}%</strong>
                    </div>
                </div>
            </div>

            <!-- Prerequisites -->
            {% if course.prerequisites.all %}
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Prerequisites</h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        {% for prereq in course.prerequisites.all %}
                        <li class="mb-2">
                            <i class="bi bi-check-circle text-success me-1"></i>
                            {{ prereq.title }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
