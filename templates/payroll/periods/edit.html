{% extends 'base/base.html' %}
{% load static %}

{% block title %}Edit Payroll Period{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'ui/css/app.css' %}">
{% endblock %}

{% block content %}
<main class="min-h-screen h-auto">
    <div class="px-5 py-3">
        <form method="post">
            {% csrf_token %}

            <!-- Period Name and Type -->
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="col-span-2 md:col-span-1">
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Period Name *</label>
                    <input type="text"
                           id="name"
                           name="name"
                           value="{{ period.name }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           required
                           placeholder="e.g., September 2024">
                    <p class="text-xs text-gray-500 mt-1">Give this period a descriptive name</p>
                </div>

                <div class="col-span-2 md:col-span-1">
                    <label for="period_type" class="block text-sm font-medium text-gray-700 mb-1">Period Type *</label>
                    <select id="period_type"
                            name="period_type"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required>
                        <option value="">Select period type</option>
                        <option value="MONTHLY" {% if period.period_type == 'MONTHLY' %}selected{% endif %}>Monthly</option>
                        <option value="SEMI_MONTHLY" {% if period.period_type == 'SEMI_MONTHLY' %}selected{% endif %}>Semi-Monthly</option>
                        <option value="WEEKLY" {% if period.period_type == 'WEEKLY' %}selected{% endif %}>Weekly</option>
                        <option value="BI_WEEKLY" {% if period.period_type == 'BI_WEEKLY' %}selected{% endif %}>Bi-Weekly</option>
                    </select>
                </div>
            </div>

            <!-- Status -->
            <div class="mb-4">
                <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status *</label>
                <select id="status"
                        name="status"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        required>
                    <option value="DRAFT" {% if period.status == 'DRAFT' %}selected{% endif %}>Draft</option>
                    <option value="PROCESSING" {% if period.status == 'PROCESSING' %}selected{% endif %}>Processing</option>
                    <option value="APPROVED" {% if period.status == 'APPROVED' %}selected{% endif %}>Approved</option>
                    <option value="PAID" {% if period.status == 'PAID' %}selected{% endif %}>Paid</option>
                    <option value="CANCELLED" {% if period.status == 'CANCELLED' %}selected{% endif %}>Cancelled</option>
                </select>
                <p class="text-xs text-gray-500 mt-1">Select the current status of the payroll period</p>
            </div>

            <!-- Dates -->
            <div class="grid grid-cols-3 gap-4 mb-4">
                <div class="col-span-3 md:col-span-1">
                    <label for="start_date" class="block text-sm font-medium text-gray-700 mb-1">Start Date *</label>
                    <input type="date"
                           id="start_date"
                           name="start_date"
                           value="{{ period.start_date|date:'Y-m-d' }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           required>
                </div>

                <div class="col-span-3 md:col-span-1">
                    <label for="end_date" class="block text-sm font-medium text-gray-700 mb-1">End Date *</label>
                    <input type="date"
                           id="end_date"
                           name="end_date"
                           value="{{ period.end_date|date:'Y-m-d' }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           required>
                </div>

                <div class="col-span-3 md:col-span-1">
                    <label for="payment_date" class="block text-sm font-medium text-gray-700 mb-1">Payment Date *</label>
                    <input type="date"
                           id="payment_date"
                           name="payment_date"
                           value="{{ period.payment_date|date:'Y-m-d' }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           required>
                </div>
            </div>

            <!-- Info Note -->
            <div class="mb-6">
                <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
                    <div class="flex">
                        <i class="fas fa-info-circle text-blue-500 mt-0.5 mr-3"></i>
                        <div class="text-sm text-blue-700">
                            <strong>Note:</strong> Make sure the dates don't overlap with existing payroll periods.
                            The payment date should be after the end date of the period.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="flex justify-end gap-3">
                <a href="{% url 'payroll:periods' %}"
                   class="button-min-danger">Cancel
                </a>
                <button type="submit"
                    class="button-min-primary px-4">Save
                </button>
            </div>
        </form>
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Validate end date is after start date
    const startDateInput = document.getElementById('start_date');
    const endDateInput = document.getElementById('end_date');

    startDateInput.addEventListener('change', function() {
        endDateInput.min = this.value;
    });

    endDateInput.addEventListener('change', function() {
        const paymentDateInput = document.getElementById('payment_date');
        paymentDateInput.min = this.value;
    });
});
</script>
{% endblock %}
