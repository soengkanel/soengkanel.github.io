{% extends 'base/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Onboarding" %} - {{ onboarding.employee.full_name }}{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        padding: 6px 0;
        margin-bottom: 12px;
    }

    .page-header h2 {
        font-size: 16px;
        font-weight: 600;
        margin: 0;
        color: #1a1a1a;
    }

    .info-card {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
    }

    .info-row {
        display: flex;
        padding: 8px 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        font-size: 12px;
        color: #6b7280;
        width: 150px;
        flex-shrink: 0;
    }

    .info-value {
        font-size: 13px;
        color: #1a1a1a;
        font-weight: 500;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 2px solid #e2e8f0;
    }

    .section-title {
        font-size: 14px;
        font-weight: 600;
        color: #1a1a1a;
        margin: 0;
    }

    .task-card {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 12px;
        transition: all 0.2s;
    }

    .task-card:hover {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .task-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 8px;
    }

    .task-title {
        font-size: 13px;
        font-weight: 600;
        color: #1a1a1a;
        margin: 0;
    }

    .task-description {
        font-size: 12px;
        color: #6b7280;
        margin: 8px 0;
    }

    .task-meta {
        display: flex;
        gap: 16px;
        font-size: 11px;
        color: #6b7280;
        margin-top: 8px;
    }

    .task-actions {
        display: flex;
        gap: 8px;
        margin-top: 8px;
    }

    .badge {
        font-size: 10px;
        font-weight: 500;
        padding: 3px 8px;
    }

    .priority-low {
        color: #059669;
    }

    .priority-medium {
        color: #f59e0b;
    }

    .priority-high {
        color: #ef4444;
    }

    .priority-critical {
        color: #dc2626;
        font-weight: 600;
    }

    .progress-circle {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: conic-gradient(
            #10b981 0% var(--progress),
            #e5e7eb var(--progress) 100%
        );
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .progress-circle::before {
        content: '';
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: white;
        position: absolute;
    }

    .progress-text {
        position: relative;
        z-index: 1;
        font-size: 16px;
        font-weight: 700;
        color: #1a1a1a;
    }

    .tab-pane {
        padding-top: 16px;
    }

    .nav-tabs {
        border-bottom: 2px solid #e5e7eb;
    }

    .nav-tabs .nav-link {
        font-size: 13px;
        color: #6b7280;
        border: none;
        border-bottom: 2px solid transparent;
        padding: 8px 16px;
    }

    .nav-tabs .nav-link.active {
        color: #3b82f6;
        border-bottom-color: #3b82f6;
        background: none;
    }

    .task-overdue {
        border-left: 3px solid #ef4444;
    }

    .task-pending {
        border-left: 3px solid #f59e0b;
    }

    .task-in-progress {
        border-left: 3px solid #3b82f6;
    }

    .task-completed {
        border-left: 3px solid #10b981;
        opacity: 0.7;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="page-header">
        <h2>{% trans "Onboarding" %} - {{ onboarding.employee.full_name }}</h2>
    </div>

    <div class="row">
        <!-- Left Column: Info & Progress -->
        <div class="col-lg-4">
            <!-- Employee Info -->
            <div class="info-card">
                <h3 class="section-title mb-3">{% trans "Employee Information" %}</h3>
                <div class="info-row">
                    <div class="info-label">{% trans "Employee ID" %}</div>
                    <div class="info-value">{{ onboarding.employee.employee_id }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Department" %}</div>
                    <div class="info-value">{{ onboarding.employee.department.name|default:"-" }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Position" %}</div>
                    <div class="info-value">{{ onboarding.employee.position.name|default:"-" }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Hire Date" %}</div>
                    <div class="info-value">{{ onboarding.employee.hire_date|date:"M d, Y" }}</div>
                </div>
            </div>

            <!-- Onboarding Progress -->
            <div class="info-card">
                <h3 class="section-title mb-3">{% trans "Onboarding Progress" %}</h3>
                <div class="text-center mb-3">
                    <div class="progress-circle mx-auto"
                         style="--progress: {{ onboarding.progress_percentage }}%">
                        <span class="progress-text">{{ onboarding.progress_percentage }}%</span>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Status" %}</div>
                    <div class="info-value">
                        <span class="badge bg-{% if onboarding.status == 'completed' %}success{% elif onboarding.status == 'in_progress' %}primary{% elif onboarding.status == 'paused' %}warning{% else %}secondary{% endif %}">
                            {{ onboarding.get_status_display }}
                        </span>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Start Date" %}</div>
                    <div class="info-value">{{ onboarding.start_date|date:"M d, Y" }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Expected Completion" %}</div>
                    <div class="info-value">
                        {{ onboarding.expected_completion_date|date:"M d, Y" }}
                        {% if onboarding.is_overdue %}
                            <span class="badge bg-danger ms-1">Overdue</span>
                        {% endif %}
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Tasks" %}</div>
                    <div class="info-value">{{ onboarding.completed_tasks }}/{{ onboarding.total_tasks }}</div>
                </div>
                {% if onboarding.template %}
                <div class="info-row">
                    <div class="info-label">{% trans "Template" %}</div>
                    <div class="info-value">{{ onboarding.template.name }}</div>
                </div>
                {% endif %}
            </div>

            <!-- Team -->
            <div class="info-card">
                <h3 class="section-title mb-3">{% trans "Onboarding Team" %}</h3>
                {% if onboarding.hr_representative %}
                <div class="info-row">
                    <div class="info-label">{% trans "HR Representative" %}</div>
                    <div class="info-value">{{ onboarding.hr_representative.full_name }}</div>
                </div>
                {% endif %}
                {% if onboarding.buddy %}
                <div class="info-row">
                    <div class="info-label">{% trans "Buddy" %}</div>
                    <div class="info-value">{{ onboarding.buddy.full_name }}</div>
                </div>
                {% endif %}
                {% if onboarding.manager %}
                <div class="info-row">
                    <div class="info-label">{% trans "Manager" %}</div>
                    <div class="info-value">{{ onboarding.manager.full_name }}</div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Right Column: Tasks -->
        <div class="col-lg-8">
            <div class="info-card">
                <h3 class="section-title mb-3">{% trans "Onboarding Tasks" %}</h3>

                <!-- Tabs for task status -->
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#all-tasks" type="button">
                            {% trans "All Tasks" %} ({{ tasks.count }})
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#pending-tasks" type="button">
                            {% trans "Pending" %} ({{ pending_tasks.count }})
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#in-progress-tasks" type="button">
                            {% trans "In Progress" %} ({{ in_progress_tasks.count }})
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#completed-tasks" type="button">
                            {% trans "Completed" %} ({{ completed_tasks.count }})
                        </button>
                    </li>
                </ul>

                <!-- Tab content -->
                <div class="tab-content">
                    <!-- All Tasks -->
                    <div class="tab-pane fade show active" id="all-tasks">
                        {% for task in tasks %}
                            {% include 'hr/lifecycle/_task_card.html' with task=task %}
                        {% empty %}
                            <p class="text-muted text-center py-4">{% trans "No tasks found" %}</p>
                        {% endfor %}
                    </div>

                    <!-- Pending Tasks -->
                    <div class="tab-pane fade" id="pending-tasks">
                        {% for task in pending_tasks %}
                            {% include 'hr/lifecycle/_task_card.html' with task=task %}
                        {% empty %}
                            <p class="text-muted text-center py-4">{% trans "No pending tasks" %}</p>
                        {% endfor %}
                    </div>

                    <!-- In Progress Tasks -->
                    <div class="tab-pane fade" id="in-progress-tasks">
                        {% for task in in_progress_tasks %}
                            {% include 'hr/lifecycle/_task_card.html' with task=task %}
                        {% empty %}
                            <p class="text-muted text-center py-4">{% trans "No tasks in progress" %}</p>
                        {% endfor %}
                    </div>

                    <!-- Completed Tasks -->
                    <div class="tab-pane fade" id="completed-tasks">
                        {% for task in completed_tasks %}
                            {% include 'hr/lifecycle/_task_card.html' with task=task %}
                        {% empty %}
                            <p class="text-muted text-center py-4">{% trans "No completed tasks" %}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
