{% extends 'base/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Exit Interview" %} - {{ exit_interview.employee.full_name }}{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        padding: 6px 0;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .page-header h2 {
        font-size: 16px;
        font-weight: 600;
        margin: 0;
        color: #1a1a1a;
    }

    .info-card {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
    }

    .section-title {
        font-size: 14px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e2e8f0;
    }

    .info-row {
        display: flex;
        padding: 8px 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        font-size: 12px;
        color: #6b7280;
        width: 180px;
        flex-shrink: 0;
    }

    .info-value {
        font-size: 13px;
        color: #1a1a1a;
        font-weight: 500;
    }

    .rating-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin: 16px 0;
    }

    .rating-card {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 12px;
        text-align: center;
    }

    .rating-label {
        font-size: 11px;
        color: #6b7280;
        text-transform: uppercase;
        margin-bottom: 8px;
    }

    .rating-value {
        font-size: 24px;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 4px;
    }

    .rating-stars {
        color: #fbbf24;
        font-size: 16px;
    }

    .feedback-box {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 12px;
        margin: 12px 0;
    }

    .feedback-label {
        font-size: 12px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
    }

    .feedback-text {
        font-size: 13px;
        color: #1f2937;
        line-height: 1.6;
    }

    .action-buttons {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .checklist-summary {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        border-radius: 6px;
        padding: 12px;
        margin-top: 16px;
    }

    .progress-bar-custom {
        height: 8px;
        background: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 8px;
    }

    .progress-fill {
        height: 100%;
        background: #10b981;
        transition: width 0.3s;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="page-header">
        <h2>{% trans "Exit Interview" %} - {{ exit_interview.employee.full_name }}</h2>
        <div class="action-buttons">
            {% if exit_interview.status != 'completed' %}
                <a href="{% url 'hr:exit_interview_update' exit_interview.pk %}"
                   class="btn btn-primary btn-sm">{% trans "Edit Interview" %}</a>
            {% endif %}
            <a href="{% url 'hr:exit_checklist_detail' exit_interview.employee.pk %}"
               class="btn btn-secondary btn-sm">{% trans "View Exit Checklist" %}</a>
            <a href="{% url 'hr:exit_interview_list' %}" class="btn btn-outline-secondary btn-sm">{% trans "Back to List" %}</a>
        </div>
    </div>

    <div class="row">
        <!-- Left Column -->
        <div class="col-lg-8">
            <!-- Employee Info -->
            <div class="info-card">
                <h3 class="section-title">{% trans "Employee Information" %}</h3>
                <div class="info-row">
                    <div class="info-label">{% trans "Employee ID" %}</div>
                    <div class="info-value">{{ exit_interview.employee.employee_id }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Full Name" %}</div>
                    <div class="info-value">{{ exit_interview.employee.full_name }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Department" %}</div>
                    <div class="info-value">{{ exit_interview.employee.department.name|default:"-" }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Position" %}</div>
                    <div class="info-value">{{ exit_interview.employee.position.name|default:"-" }}</div>
                </div>
            </div>

            <!-- Exit Details -->
            <div class="info-card">
                <h3 class="section-title">{% trans "Exit Details" %}</h3>
                <div class="info-row">
                    <div class="info-label">{% trans "Exit Reason" %}</div>
                    <div class="info-value">
                        <span class="badge bg-{% if exit_interview.exit_reason == 'resignation' %}info{% elif exit_interview.exit_reason == 'termination' %}danger{% elif exit_interview.exit_reason == 'retirement' %}success{% else %}secondary{% endif %}">
                            {{ exit_interview.get_exit_reason_display }}
                        </span>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Last Working Day" %}</div>
                    <div class="info-value">{{ exit_interview.last_working_day|date:"M d, Y" }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Interview Date" %}</div>
                    <div class="info-value">{{ exit_interview.interview_date|date:"M d, Y" }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Interviewer" %}</div>
                    <div class="info-value">{{ exit_interview.interviewer.full_name|default:"-" }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">{% trans "Status" %}</div>
                    <div class="info-value">
                        <span class="badge bg-{% if exit_interview.status == 'completed' %}success{% elif exit_interview.status == 'scheduled' %}primary{% elif exit_interview.status == 'in_progress' %}warning{% else %}secondary{% endif %}">
                            {{ exit_interview.get_status_display }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Ratings -->
            <div class="info-card">
                <h3 class="section-title">{% trans "Satisfaction Ratings" %}</h3>
                <div class="rating-section">
                    {% if exit_interview.job_satisfaction %}
                    <div class="rating-card">
                        <div class="rating-label">{% trans "Job Satisfaction" %}</div>
                        <div class="rating-value">{{ exit_interview.job_satisfaction }}/5</div>
                        <div class="rating-stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= exit_interview.job_satisfaction %}‚òÖ{% else %}‚òÜ{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    {% if exit_interview.work_environment %}
                    <div class="rating-card">
                        <div class="rating-label">{% trans "Work Environment" %}</div>
                        <div class="rating-value">{{ exit_interview.work_environment }}/5</div>
                        <div class="rating-stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= exit_interview.work_environment %}‚òÖ{% else %}‚òÜ{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    {% if exit_interview.management_quality %}
                    <div class="rating-card">
                        <div class="rating-label">{% trans "Management Quality" %}</div>
                        <div class="rating-value">{{ exit_interview.management_quality }}/5</div>
                        <div class="rating-stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= exit_interview.management_quality %}‚òÖ{% else %}‚òÜ{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    {% if exit_interview.career_development %}
                    <div class="rating-card">
                        <div class="rating-label">{% trans "Career Development" %}</div>
                        <div class="rating-value">{{ exit_interview.career_development }}/5</div>
                        <div class="rating-stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= exit_interview.career_development %}‚òÖ{% else %}‚òÜ{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    {% if exit_interview.work_life_balance %}
                    <div class="rating-card">
                        <div class="rating-label">{% trans "Work-Life Balance" %}</div>
                        <div class="rating-value">{{ exit_interview.work_life_balance }}/5</div>
                        <div class="rating-stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= exit_interview.work_life_balance %}‚òÖ{% else %}‚òÜ{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    {% if exit_interview.compensation_benefits %}
                    <div class="rating-card">
                        <div class="rating-label">{% trans "Compensation & Benefits" %}</div>
                        <div class="rating-value">{{ exit_interview.compensation_benefits }}/5</div>
                        <div class="rating-stars">
                            {% for i in "12345" %}
                                {% if forloop.counter <= exit_interview.compensation_benefits %}‚òÖ{% else %}‚òÜ{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>

                {% if exit_interview.overall_satisfaction %}
                <div class="text-center mt-3 pt-3" style="border-top: 1px solid #e5e7eb;">
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">{% trans "Overall Satisfaction" %}</div>
                    <div style="font-size: 32px; font-weight: 700; color: #1a1a1a;">{{ exit_interview.overall_satisfaction }}/5</div>
                    <div class="rating-stars" style="font-size: 24px;">
                        {% for i in "12345" %}
                            {% if forloop.counter <= exit_interview.overall_satisfaction %}‚òÖ{% else %}‚òÜ{% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Feedback -->
            <div class="info-card">
                <h3 class="section-title">{% trans "Detailed Feedback" %}</h3>

                {% if exit_interview.liked_most %}
                <div class="feedback-box">
                    <div class="feedback-label">‚úÖ {% trans "What did you like most?" %}</div>
                    <div class="feedback-text">{{ exit_interview.liked_most }}</div>
                </div>
                {% endif %}

                {% if exit_interview.liked_least %}
                <div class="feedback-box">
                    <div class="feedback-label">‚ùå {% trans "What did you like least?" %}</div>
                    <div class="feedback-text">{{ exit_interview.liked_least }}</div>
                </div>
                {% endif %}

                {% if exit_interview.improvements %}
                <div class="feedback-box">
                    <div class="feedback-label">üí° {% trans "Suggested Improvements" %}</div>
                    <div class="feedback-text">{{ exit_interview.improvements }}</div>
                </div>
                {% endif %}

                {% if exit_interview.recommend_company is not None %}
                <div class="feedback-box">
                    <div class="feedback-label">üéØ {% trans "Would Recommend Company?" %}</div>
                    <div class="feedback-text">
                        <span class="badge bg-{% if exit_interview.recommend_company %}success{% else %}danger{% endif %}">
                            {% if exit_interview.recommend_company %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}
                        </span>
                    </div>
                </div>
                {% endif %}

                {% if exit_interview.additional_comments %}
                <div class="feedback-box">
                    <div class="feedback-label">üìù {% trans "Additional Comments" %}</div>
                    <div class="feedback-text">{{ exit_interview.additional_comments }}</div>
                </div>
                {% endif %}

                {% if exit_interview.confidential_feedback %}
                <div class="feedback-box" style="border-left: 3px solid #ef4444;">
                    <div class="feedback-label">üîí {% trans "Confidential Feedback (HR Only)" %}</div>
                    <div class="feedback-text">{{ exit_interview.confidential_feedback }}</div>
                </div>
                {% endif %}
            </div>

            <!-- Follow-up -->
            {% if exit_interview.follow_up_required %}
            <div class="info-card" style="border-left: 3px solid #f59e0b;">
                <h3 class="section-title">‚ö†Ô∏è {% trans "Follow-up Required" %}</h3>
                {% if exit_interview.follow_up_notes %}
                    <p style="font-size: 13px; color: #374151;">{{ exit_interview.follow_up_notes }}</p>
                {% else %}
                    <p style="font-size: 13px; color: #6b7280;">{% trans "Follow-up required but no notes provided yet." %}</p>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Right Column -->
        <div class="col-lg-4">
            <!-- Quick Actions -->
            <div class="info-card">
                <h3 class="section-title">{% trans "Quick Actions" %}</h3>
                <div class="d-grid gap-2">
                    <a href="{% url 'hr:exit_checklist_detail' exit_interview.employee.pk %}"
                       class="btn btn-primary btn-sm">
                        üìã {% trans "View Exit Checklist" %}
                    </a>
                    {% if exit_interview.status != 'completed' %}
                        <a href="{% url 'hr:exit_interview_update' exit_interview.pk %}"
                           class="btn btn-outline-primary btn-sm">
                            ‚úèÔ∏è {% trans "Edit Interview" %}
                        </a>
                    {% endif %}
                    <a href="{% url 'hr:employee_detail' exit_interview.employee.pk %}"
                       class="btn btn-outline-secondary btn-sm">
                        üë§ {% trans "View Employee" %}
                    </a>
                </div>
            </div>

            <!-- Exit Checklist Summary -->
            {% if exit_checklist %}
            <div class="info-card">
                <h3 class="section-title">{% trans "Exit Checklist Status" %}</h3>
                <div class="checklist-summary">
                    <div class="text-center mb-2">
                        <div style="font-size: 24px; font-weight: 700; color: #1a1a1a;">
                            {{ exit_checklist.completion_percentage|floatformat:0 }}%
                        </div>
                        <div style="font-size: 11px; color: #6b7280;">{% trans "Complete" %}</div>
                    </div>
                    <div class="progress-bar-custom">
                        <div class="progress-fill" style="width: {{ exit_checklist.completion_percentage }}%"></div>
                    </div>
                    <div class="text-center mt-2">
                        <a href="{% url 'hr:exit_checklist_detail' exit_interview.employee.pk %}" class="btn btn-sm btn-primary">
                            {% trans "Update Checklist" %}
                        </a>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="info-card">
                <h3 class="section-title">{% trans "Exit Checklist" %}</h3>
                <p style="font-size: 12px; color: #6b7280; text-align: center; padding: 12px 0;">
                    {% trans "No exit checklist created yet" %}
                </p>
                <div class="text-center">
                    <a href="{% url 'hr:exit_checklist_update' exit_interview.employee.pk %}" class="btn btn-sm btn-primary">
                        {% trans "Create Checklist" %}
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
