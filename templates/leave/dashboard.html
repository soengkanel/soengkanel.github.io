{% extends 'base/base.html' %}
{% load static %}

{% block title %}Leave Management{% endblock %}

{% block main_class %}col-md-10 ms-sm-auto col-lg-10{% endblock %}

{% block extra_css %}
<style>
    .page-header { padding: 6px 0; margin-bottom: 12px; }
    .page-header h2 { font-size: 16px; font-weight: 600; margin: 0; color: #1a1a1a; }
    .stat-number { font-size: 16px; font-weight: 700; color: #1a1a1a; margin: 0; }
    .stat-label { font-size: 10px; color: #6b7280; margin: 2px 0 0 0; text-transform: uppercase; font-weight: 500; }
    .module-card { background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; transition: box-shadow 0.2s; }
    .module-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .module-icon { font-size: 20px; color: #3b82f6; }
    .table { font-size: 11px; }
    .table th { font-weight: 600; color: #374151; text-transform: uppercase; font-size: 10px; padding: 8px; border-bottom: 2px solid #e2e8f0; }
    .table td { padding: 8px; vertical-align: middle; }
    .status-badge { padding: 3px 8px; border-radius: 12px; font-size: 10px; font-weight: 500; text-transform: uppercase; }
    .status-pending { background-color: #fef3c7; color: #92400e; }
    .status-approved { background-color: #dcfce7; color: #166534; }
    .status-rejected { background-color: #fee2e2; color: #991b1b; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="flex justify-between items-center mb-3">
        <h2 class="text-xl font-bold">Leave Management</h2>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-3">
        <div class="col-3">
            <div class="rounded-xl bg-white border px-3 py-2 shadow-sm text-center">
                <div class="stat-number">{{ stats.total_applications }}</div>
                <div class="stat-label">Total Applications</div>
            </div>
        </div>
        <div class="col-3">
            <div class="rounded-xl bg-white border px-3 py-2 shadow-sm text-center">
                <div class="stat-number">{{ stats.pending_applications }}</div>
                <div class="stat-label">Pending</div>
            </div>
        </div>
        <div class="col-3">
            <div class="rounded-xl bg-white border px-3 py-2 shadow-sm text-center">
                <div class="stat-number">{{ stats.approved_applications }}</div>
                <div class="stat-label">Approved</div>
            </div>
        </div>
        <div class="col-3">
            <div class="rounded-xl bg-white border px-3 py-2 shadow-sm text-center">
                <div class="stat-number">{{ stats.total_leave_types }}</div>
                <div class="stat-label">Leave Types</div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-3">
        <div class="col-3">
            <a href="{% url 'leave:application_create' %}" class="module-card text-decoration-none d-block">
                <div class="d-flex align-items-center">
                    <i class="bi bi-file-earmark-plus module-icon me-2"></i>
                    <div>
                        <div style="font-size: 12px; font-weight: 600; color: #1a1a1a;">Apply Leave</div>
                        <div style="font-size: 10px; color: #6b7280;">Submit new request</div>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-3">
            <a href="{% url 'leave:application_list' %}" class="module-card text-decoration-none d-block">
                <div class="d-flex align-items-center">
                    <i class="bi bi-list-check module-icon me-2"></i>
                    <div>
                        <div style="font-size: 12px; font-weight: 600; color: #1a1a1a;">Applications</div>
                        <div style="font-size: 10px; color: #6b7280;">View all requests</div>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-3">
            <a href="{% url 'leave:allocation_list' %}" class="module-card text-decoration-none d-block">
                <div class="d-flex align-items-center">
                    <i class="bi bi-calendar-check module-icon me-2"></i>
                    <div>
                        <div style="font-size: 12px; font-weight: 600; color: #1a1a1a;">Allocations</div>
                        <div style="font-size: 10px; color: #6b7280;">Manage balances</div>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-3">
            <a href="{% url 'leave:type_list' %}" class="module-card text-decoration-none d-block">
                <div class="d-flex align-items-center">
                    <i class="bi bi-gear module-icon me-2"></i>
                    <div>
                        <div style="font-size: 12px; font-weight: 600; color: #1a1a1a;">Leave Types</div>
                        <div style="font-size: 10px; color: #6b7280;">Configure types</div>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- Recent Applications and Pending Approvals -->
    <div class="row">
        <!-- Recent Applications -->
        <div class="col-6">
            <div class="bg-white border rounded-xl p-3">
                <h6 class="font-bold mb-2" style="font-size: 12px;">Recent Applications</h6>
                {% if recent_applications %}
                <table class="table table-sm mb-0">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Type</th>
                            <th>Dates</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app in recent_applications %}
                        <tr>
                            <td><a href="{% url 'leave:application_detail' app.id %}" class="text-decoration-none">{{ app.employee.get_full_name|truncatechars:20 }}</a></td>
                            <td>{{ app.leave_type.code }}</td>
                            <td>{{ app.from_date|date:"M d" }} - {{ app.to_date|date:"M d" }}</td>
                            <td>
                                <span class="status-badge status-{{ app.status }}">{{ app.get_status_display }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-muted text-center my-2" style="font-size: 11px;">No recent applications</p>
                {% endif %}
            </div>
        </div>

        <!-- Pending Approvals -->
        <div class="col-6">
            <div class="bg-white border rounded-xl p-3">
                <h6 class="font-bold mb-2" style="font-size: 12px;">Pending Approvals</h6>
                {% if pending_approvals %}
                <table class="table table-sm mb-0">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Type</th>
                            <th>Days</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app in pending_approvals %}
                        <tr>
                            <td>{{ app.employee.get_full_name|truncatechars:20 }}</td>
                            <td>{{ app.leave_type.code }}</td>
                            <td>{{ app.total_leave_days }}</td>
                            <td>
                                <a href="{% url 'leave:application_detail' app.id %}" class="button-min-default" style="padding: 2px 8px; font-size: 10px;">
                                    View
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-muted text-center my-2" style="font-size: 11px;">No pending approvals</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
