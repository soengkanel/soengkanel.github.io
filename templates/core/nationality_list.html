{% extends 'base/base.html' %}
{% load static %}

{% block title %}Nationality Management - GuanYu{% endblock %}

{% block main_class %}col-md-10 ms-sm-auto col-lg-10{% endblock %}

{% block extra_css %}
<style>
/* Ultra-Minimal Design System - Nationality Management */
.page-header {
    padding: 6px 0;
    margin-bottom: 12px;
}
.page-header h2 {
    font-size: 16px;
    font-weight: 600;
    margin: 0;
    color: #1a1a1a;
}

/* Ultra-Minimal search filters */
.search-filters {
    background: #f8fafb;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    padding: 8px;
    margin-bottom: 12px;
}
.filter-row {
    display: grid;
    grid-template-columns: 2fr 1fr auto;
    gap: 8px;
    align-items: end;
}
.form-label {
    font-size: 10px !important;
    margin-bottom: 3px !important;
    font-weight: 500;
    color: #374151;
}
.form-control, .form-select {
    font-size: 11px !important;
    padding: 4px 6px !important;
    height: auto !important;
    border-radius: 3px;
    border: 1px solid #d1d5db;
    line-height: 1.4;
    background: white;
}

/* Results table */
.table-container {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    overflow: hidden;
}
.table {
    margin: 0;
    font-size: 11px;
}
.table th {
    background: #f8fafb;
    border-bottom: 1px solid #e2e8f0;
    font-size: 10px !important;
    font-weight: 600;
    color: #374151;
    padding: 6px 8px !important;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.table td {
    padding: 6px 8px !important;
    border-bottom: 1px solid #f1f5f9;
    vertical-align: middle;
}
.table tbody tr:hover {
    background: #f8fafb;
}

/* Action buttons */
.btn-sm {
    font-size: 9px !important;
    padding: 2px 6px !important;
    border-radius: 2px;
    text-decoration: none;
}
.btn-outline-primary {
    border: 1px solid #3b82f6;
    color: #3b82f6;
    background: transparent;
}
.btn-outline-primary:hover {
    background: #3b82f6;
    color: white;
}

/* Create button */
.btn-primary {
    background: #3b82f6;
    border: 1px solid #3b82f6;
    color: white;
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 3px;
    text-decoration: none;
}
.btn-primary:hover {
    background: #2563eb;
    border-color: #2563eb;
}

/* Pagination */
.pagination {
    margin: 0;
    font-size: 10px;
}
.page-link {
    padding: 4px 6px;
    font-size: 10px;
    border-radius: 2px;
    margin: 0 1px;
}

/* No results */
.no-results {
    text-align: center;
    padding: 24px;
    color: #6b7280;
    font-size: 11px;
}
</style>
{% endblock %}

{% block content %}
<div class="page-header d-flex justify-content-between align-items-center">
    <h2>{{ title }}</h2>
    <a href="{% url 'nationality_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle me-1"></i>Add Nationality
    </a>
</div>

<!-- Search and Filter Controls -->
<div class="search-filters">
    <form method="get" class="filter-row">
        <div>
            <label for="search" class="form-label">Search</label>
            <input type="text" class="form-control" id="search" name="search"
                   value="{{ search_query }}" placeholder="Search by zip code, country code, name, or nationality...">
        </div>
        <div>
            <label for="region" class="form-label">Region</label>
            <select class="form-select" id="region" name="region">
                <option value="">All Regions</option>
                {% for region in regions %}
                <option value="{{ region }}" {% if region == region_filter %}selected{% endif %}>{{ region }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <button type="submit" class="btn btn-outline-primary btn-sm">Filter</button>
            {% if search_query or region_filter %}
                <a href="{% url 'nationality_list' %}" class="btn btn-outline-secondary btn-sm ms-1">Clear</a>
            {% endif %}
        </div>
    </form>
</div>

<!-- Results -->
<div class="table-container">
    {% if page_obj and page_obj.object_list %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Zip Code</th>
                    <th>Country Code</th>
                    <th>Country Name</th>
                    <th>Nationality</th>
                    <th>Region</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for nationality in page_obj %}
                <tr>
                    <td><strong>{{ nationality.zip_code }}</strong></td>
                    <td><span class="badge bg-secondary">{{ nationality.country_code }}</span></td>
                    <td>{{ nationality.country_name }}</td>
                    <td>{{ nationality.nationality }}</td>
                    <td>{{ nationality.region }}</td>
                    <td>{{ nationality.created_at|date:"M d, Y" }}</td>
                    <td>
                        <a href="{% url 'nationality_detail' nationality.pk %}"
                           class="btn btn-outline-primary btn-sm">View</a>
                        <a href="{% url 'nationality_edit' nationality.pk %}"
                           class="btn btn-outline-secondary btn-sm">Edit</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <div class="d-flex justify-content-between align-items-center p-2">
            <small class="text-muted">
                Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ page_obj.paginator.count }} nationalities
            </small>
            <nav>
                <ul class="pagination pagination-sm">
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if region_filter %}&region={{ region_filter }}{% endif %}">Previous</a>
                        </li>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if region_filter %}&region={{ region_filter }}{% endif %}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if region_filter %}&region={{ region_filter }}{% endif %}">Next</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        {% endif %}
    {% else %}
        <div class="no-results">
            <i class="bi bi-inbox"></i>
            <p>No nationalities found.</p>
            {% if search_query or region_filter %}
                <a href="{% url 'nationality_list' %}" class="btn btn-outline-primary btn-sm">Clear filters</a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}