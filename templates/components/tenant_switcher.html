{% load tenant_tags %}

<!-- Tenant Switcher Component -->
<div class="tenant-switcher">
    <div class="dropdown">
        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="tenantSwitcher" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-building"></i>
            {% if tenant %}
                {{ tenant.name }}
            {% else %}
                Select Tenant
            {% endif %}
        </button>
        <ul class="dropdown-menu" aria-labelledby="tenantSwitcher">
            <!-- These should be populated based on available tenants -->
            <li><a class="dropdown-item" href="?tenant=kk">KK</a></li>
            <li><a class="dropdown-item" href="?tenant=osm">OSM</a></li>
            <!-- Add more tenants as needed -->
        </ul>
    </div>
</div>

<style>
.tenant-switcher {
    display: inline-block;
    margin: 0 10px;
}

.tenant-switcher .dropdown-toggle {
    font-size: 0.875rem;
    padding: 0.25rem 0.5rem;
}

.tenant-switcher .dropdown-menu {
    min-width: 150px;
}

.tenant-switcher .dropdown-item {
    font-size: 0.875rem;
}

.tenant-switcher .dropdown-item:hover {
    background-color: #f8f9fa;
}

.tenant-switcher .dropdown-item.active {
    background-color: #0d6efd;
    color: white;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get current tenant from URL
    const urlParams = new URLSearchParams(window.location.search);
    const currentTenant = urlParams.get('tenant');
    
    // Mark current tenant as active
    if (currentTenant) {
        const dropdownItems = document.querySelectorAll('.tenant-switcher .dropdown-item');
        dropdownItems.forEach(item => {
            const href = item.getAttribute('href');
            if (href && href.includes('tenant=' + currentTenant)) {
                item.classList.add('active');
            }
        });
    }
    
    // Handle tenant switching
    document.querySelectorAll('.tenant-switcher .dropdown-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const href = this.getAttribute('href');
            const newParams = new URLSearchParams(href.substring(1));
            const newTenant = newParams.get('tenant');
            
            // Preserve existing URL parameters except tenant
            const currentParams = new URLSearchParams(window.location.search);
            currentParams.set('tenant', newTenant);
            
            // Redirect with new tenant parameter
            window.location.href = window.location.pathname + '?' + currentParams.toString();
        });
    });
});
</script>