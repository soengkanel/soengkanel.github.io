{% extends 'base.html' %}

{% block title %}{{ team.team_name }} Projects{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'project:team_list' %}">Teams</a></li>
                <li class="breadcrumb-item"><a href="{% url 'project:team_detail' team.id %}">{{ team.team_name }}</a></li>
                <li class="breadcrumb-item active">Projects</li>
            </ol>
        </nav>
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="fw-bold text-dark-emphasis mb-1">{{ team.team_name }} Projects</h2>
                <p class="text-muted mb-0">Projects where team members are assigned</p>
            </div>
            <div class="d-flex gap-2">
                <a href="{% url 'project:team_detail' team.id %}" class="btn-outline-modern">
                    <i class="bi bi-arrow-left"></i> Back to Team
                </a>
                <a href="{% url 'project:project_create' %}" class="btn-primary-modern">
                    <i class="bi bi-plus-circle"></i> New Project
                </a>
            </div>
        </div>
    </div>

    <!-- Team Summary -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <div class="text-muted small">Team Code</div>
                            <div class="fw-bold">{{ team.team_code }}</div>
                        </div>
                        <div>
                            <div class="text-muted small">Members</div>
                            <div class="fw-bold">{{ team.member_count }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-muted small">Team Type</div>
                    <div class="fw-bold">{{ team.get_team_type_display }}</div>
                </div>
                <div class="col-md-3">
                    <div class="text-muted small">Active Projects</div>
                    <div class="fw-bold">{{ projects|length }}</div>
                </div>
                <div class="col-md-3">
                    {% if team.team_lead %}
                    <div class="text-muted small">Team Lead</div>
                    <div class="d-flex align-items-center">
                        <div class="avatar-sm me-2">{{ team.team_lead.first_name|first|upper }}</div>
                        <div class="fw-bold">{{ team.team_lead.full_name }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Projects -->
    {% if projects %}
    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">Active Projects ({{ projects|length }})</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Project</th>
                            <th>Project Manager</th>
                            <th>Status</th>
                            <th>Priority</th>
                            <th>Progress</th>
                            <th>Team Members</th>
                            <th>Timeline</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in projects %}
                        <tr>
                            <td>
                                <div>
                                    <div class="fw-medium">
                                        <a href="{% url 'project:project_detail' project.id %}" class="text-decoration-none">
                                            {{ project.project_name }}
                                        </a>
                                    </div>
                                    <div class="text-muted small">{{ project.project_code }}</div>
                                    {% if project.description %}
                                    <div class="text-muted small">{{ project.description|truncatewords:10 }}</div>
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                {% if project.project_manager %}
                                <div class="d-flex align-items-center">
                                    <div class="avatar-sm me-2">
                                        {{ project.project_manager.first_name|first|upper }}
                                    </div>
                                    <div>
                                        <div class="fw-medium">{{ project.project_manager.full_name }}</div>
                                        <div class="text-muted small">{{ project.project_manager.job_title|default:"Project Manager" }}</div>
                                    </div>
                                </div>
                                {% else %}
                                <span class="text-muted">Not assigned</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="status-badge status-{{ project.status }}">
                                    {{ project.get_status_display }}
                                </span>
                            </td>
                            <td>
                                <span class="priority-badge priority-{{ project.priority }}">
                                    {{ project.get_priority_display }}
                                </span>
                            </td>
                            <td>
                                <div style="width: 80px;">
                                    <div class="progress" style="height: 6px;">
                                        <div class="progress-bar" role="progressbar" style="width: {{ project.percent_complete }}%"></div>
                                    </div>
                                    <span class="small text-muted">{{ project.percent_complete|floatformat:0 }}%</span>
                                </div>
                            </td>
                            <td>
                                <div class="d-flex flex-wrap gap-1">
                                    {% for member in project.team_members.all|slice:":3" %}
                                    {% if member.employee in team.team_members.all %}
                                    <div class="avatar-xs" title="{{ member.employee.full_name }}">
                                        {{ member.employee.first_name|first|upper }}
                                    </div>
                                    {% endif %}
                                    {% endfor %}
                                    {% if project.team_members.count > 3 %}
                                    <div class="avatar-xs bg-light text-dark" title="More members">
                                        +{{ project.team_members.count|add:"-3" }}
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="text-muted small">{{ project.team_members.count }} total</div>
                            </td>
                            <td>
                                {% if project.expected_start_date %}
                                <div class="small">
                                    <div>Start: {{ project.expected_start_date|date:"M d, Y" }}</div>
                                    {% if project.expected_end_date %}
                                    <div>End: {{ project.expected_end_date|date:"M d, Y" }}</div>
                                    {% endif %}
                                </div>
                                {% else %}
                                <span class="text-muted small">Not scheduled</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="d-flex gap-1">
                                    <a href="{% url 'project:project_detail' project.id %}" class="btn-outline-modern btn-sm">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                    <a href="{% url 'project:project_edit' project.id %}" class="btn-light-modern btn-sm">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="bi bi-folder-x display-1 text-muted"></i>
        <h4 class="mt-3">No Active Projects</h4>
        <p class="text-muted">Team members are not currently assigned to any active projects.</p>
        <div class="d-flex justify-content-center gap-2">
            <a href="{% url 'project:project_create' %}" class="btn-primary-modern">
                <i class="bi bi-plus-circle"></i> Create Project
            </a>
            <a href="{% url 'project:project_list' %}" class="btn-outline-modern">
                <i class="bi bi-folder"></i> Browse Projects
            </a>
        </div>
    </div>
    {% endif %}
</div>

<style>
.avatar-sm {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 12px;
}

.avatar-xs {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 10px;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
}

.status-open { background-color: #e0e7ff; color: #3730a3; }
.status-in_progress { background-color: #dbeafe; color: #1e40af; }
.status-completed { background-color: #dcfce7; color: #166534; }
.status-on_hold { background-color: #fef3c7; color: #92400e; }
.status-cancelled { background-color: #fee2e2; color: #dc2626; }

.priority-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
}

.priority-low { background-color: #f3f4f6; color: #6b7280; }
.priority-medium { background-color: #fef3c7; color: #92400e; }
.priority-high { background-color: #fed7aa; color: #ea580c; }
.priority-urgent { background-color: #fee2e2; color: #dc2626; }
</style>
{% endblock %}