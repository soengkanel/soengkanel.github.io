{% extends 'base/base.html' %}
{% load static %}

{% block title %}All Invoices{% endblock %}

{% block extra_css %}
{% include 'includes/compact_ui.html' %}
<style>
/* Invoice-specific compact styles */
.table-actions {
    display: flex;
    gap: var(--space-1);
    align-items: center;
}

.btn-sm {
    font-size: var(--text-xs);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
    border: 1px solid transparent;
}

.btn-view {
    background: var(--primary);
    color: var(--white);
}

.btn-view:hover {
    background: var(--primary-dark);
    color: var(--white);
}

.btn-edit {
    background: var(--gray-100);
    color: var(--gray-700);
    border-color: var(--gray-200);
}

.btn-edit:hover {
    background: var(--gray-200);
    color: var(--black);
}

.btn-success {
    background: var(--success);
    color: var(--white);
}

.btn-success:hover {
    background: #047857;
    color: var(--white);
}

/* Status badges */
.status-badge {
    font-size: var(--text-xs);
    font-weight: 600;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-pending { background: var(--warning-light); color: var(--warning); }
.status-paid { background: var(--success-light); color: var(--success); }
.status-overdue { background: var(--danger-light); color: var(--danger); }
.status-cancelled { background: var(--gray-200); color: var(--gray-600); }

/* Workflow indicators */
.status-workflow {
    display: flex;
    align-items: center;
    gap: 8px;
}

.workflow-indicator {
    display: flex;
    align-items: center;
}

.workflow-step-mini {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    font-size: 12px;
    cursor: help;
    transition: all 0.2s;
}

.workflow-step-mini:hover {
    transform: scale(1.1);
}

.workflow-step-mini.completed {
    background: rgba(40, 167, 69, 0.15);
    color: #28a745;
}

.workflow-step-mini.receipt {
    background: rgba(23, 162, 184, 0.15);
    color: #17a2b8;
}

.workflow-step-mini.payment {
    background: rgba(255, 193, 7, 0.15);
    color: #ffc107;
}

.workflow-step-mini.pending {
    background: rgba(108, 117, 125, 0.15);
    color: #6c757d;
}

.filter-pill{
    border-radius:8px !important;
    padding:2px 10px;
    border: 1px solid rgba(27, 31, 35, 0.15);
    border-radius: 11px;
    box-shadow: rgba(213, 217, 217, .5) 0 2px 5px 0;
}

.filter-pill:hover{
    background: linear-gradient(180deg, oklch(74.6% 0.16 232.661) 0%, oklch(68.5% 0.169 237.323) 100%);
    background-origin: border-box;
    box-shadow: 0px 0.5px 1.5px rgba(54, 122, 246, 0.25), inset 0px 0.8px 0px -0.25px rgba(255, 255, 255, 0.2);
    color:#ffffff;
}

.filter-pill.active{
    background: linear-gradient(180deg, oklch(74.6% 0.16 232.661) 0%, oklch(68.5% 0.169 237.323) 100%);
    background-origin: border-box;
    box-shadow: 0px 0.5px 1.5px rgba(54, 122, 246, 0.25), inset 0px 0.8px 0px -0.25px rgba(255, 255, 255, 0.2);
    color:#ffffff;
}
.form-control{
    border-radius:8px;
    padding:7px 5px;
}
</style>
{% endblock %}

{% block content %}
<div class="page-container shadow-none">
    <!-- Page Header -->
    <div class="page-header px-0">
        <div class="page-header-center">
            <h1 class="page-title">
               
                All Invoices
            </h1>
            <p class="page-subtitle">Manage and track all invoice records</p>
        </div>
        <div class="header-actions">
            <a href="{% url 'billing:invoice_create' %}" class="button-min-primary">
                <div>
                    <i class="fa fa-plus me-1"></i>
                New Invoice
                </div>
            </a>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
        <!-- Quick Filters -->
        <div class="quick-filters">
            <a href="?status=" class="filter-pill {% if not request.GET.status %}active{% endif %}">All</a>
            <a href="?status=pending" class="filter-pill {% if request.GET.status == 'pending' %}active{% endif %}">Pending</a>
            <a href="?status=paid" class="filter-pill {% if request.GET.status == 'paid' %}active{% endif %}">Paid</a>
            <a href="?status=overdue" class="filter-pill {% if request.GET.status == 'overdue' %}active{% endif %}">Overdue</a>
            <a href="?status=cancelled" class="filter-pill {% if request.GET.status == 'cancelled' %}active{% endif %}">Cancelled</a>
        </div>

        <!-- Search Form -->
        <form method="get" class="form-row">
            <div class="form-group">
                <label for="search" class="form-label">Search</label>
                <input type="text" id="search" name="search" class="form-control" 
                       placeholder="Invoice number, client name..." 
                       value="{{ request.GET.search }}">
            </div>
            <div class="form-group">
                <label for="date_from" class="form-label">From Date</label>
                <input type="date" id="date_from" name="date_from" class="form-control" 
                       value="{{ request.GET.date_from }}">
            </div>
            <div class="form-group">
                <label for="date_to" class="form-label">To Date</label>
                <input type="date" id="date_to" name="date_to" class="form-control" 
                       value="{{ request.GET.date_to }}">
            </div>
            <div class="form-group">
                <button type="submit" class="button-min-primary">
                   <div>
                    <i class="bi bi-search me-1"></i>
                    Search
                   </div>
                </button>
            </div>
        </form>
    </div>

    <!-- Invoice Table -->
    <div class="table-container">
        <table class="table-compact">
            <thead>
                <tr>
                    <th>Invoice #</th>
                    <th>Client</th>
                    <th>Date</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for invoice in invoices %}
                <tr>
                    <td>
                        <strong>{{ invoice.invoice_number }}</strong>
                    </td>
                    <td>{{ invoice.get_client_name }}</td>
                    <td>{{ invoice.issue_date|date:"M d, Y" }}</td>
                    <td><strong>${{ invoice.total_amount|floatformat:2 }}</strong></td>
                    <td>
                        <div class="status-workflow">
                            <span class="status-badge status-{{ invoice.status }}">
                                {{ invoice.get_status_display }}
                            </span>
                            <div class="workflow-indicator">
                                {% if invoice.workflow_status == 'completed' %}
                                    <span class="workflow-step-mini completed" title="Completed">
                                        <i class="bi bi-check-circle-fill"></i>
                                    </span>
                                {% elif invoice.workflow_status == 'receipt_issued' %}
                                    <span class="workflow-step-mini receipt" title="Receipt Issued">
                                        <i class="bi bi-receipt"></i>
                                    </span>
                                {% elif invoice.workflow_status == 'payment_processed' %}
                                    <span class="workflow-step-mini payment" title="Payment Processing">
                                        <i class="bi bi-credit-card"></i>
                                    </span>
                                {% else %}
                                    <span class="workflow-step-mini pending" title="Pending Payment">
                                        <i class="bi bi-clock"></i>
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="table-actions">
                            <a href="{% url 'billing:invoice_detail' invoice.id %}" class="button-min-primary py-1 px-2">
                              <div>
                                <i class="bi bi-eye"></i>
                                View
                              </div>
                            </a>
                            {% if invoice.status != 'paid' %}
                            <a href="{% url 'billing:invoice_edit' invoice.id %}" class="button-min-default px-2 py-1">
                                <div>
                                    <i class="bi bi-pencil"></i>
                                Edit
                                </div>
                            </a>
                            {%endif%}
                            {% if invoice.status == 'pending' %}
                            <a href="{% url 'billing:invoice_mark_paid' invoice.id %}" class="button-min-primary px-2 py-1">
                               <div>
                                <i class="bi bi-check"></i>
                                Mark Paid
                               </div>
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: var(--space-8); color: var(--gray-500);">
                        <div class="empty-state border-none shadow-none bg-transparent">
                            <i class="bi bi-file-earmark-text" style="font-size: 2rem; color: var(--gray-300); margin-bottom: var(--space-2);"></i>
                            <p>No invoices found.</p>
                           <div class="flex justify-center w-full mt-2">
                            <a href="{% url 'billing:invoice_create' %}" class="button-min-primary">
                                <div>
                                    <i class="fa fa-plus me-1"></i>
                                Create your first invoice
                                </div>
                            </a>
                            <div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if invoices.has_other_pages %}
    <div class="pagination-container">
        <div class="pagination">
            {% if invoices.has_previous %}
                <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">« First</a>
                <a href="?page={{ invoices.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">‹ Previous</a>
            {% endif %}

            <span class="current">
                Page {{ invoices.number }} of {{ invoices.paginator.num_pages }}
            </span>

            {% if invoices.has_next %}
                <a href="?page={{ invoices.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">Next ›</a>
                <a href="?page={{ invoices.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">Last »</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %} 