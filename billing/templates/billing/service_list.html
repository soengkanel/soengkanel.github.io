{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ title }} - Billing{% endblock %}

{% block extra_css %}
{% include 'includes/compact_ui.html' %}
<style>
/* Service-specific compact styles */
.service-table-container {
    background: var(--white);
    border: var(--border);
    border-radius: var(--radius);
    overflow: hidden;
}

.service-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--text-sm);
    margin-bottom: 0;
}

.service-table th {
    padding: var(--space-3) var(--space-4);
    text-align: left;
    font-weight: 600;
    color: var(--gray-700);
    background: var(--gray-50);
    border-bottom: var(--border);
    font-size: var(--text-xs);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.service-table td {
    padding: var(--space-3) var(--space-4);
    border-bottom: 1px solid var(--gray-100);
    color: var(--gray-700);
    vertical-align: middle;
}

.service-table tbody tr:hover {
    background: var(--gray-50);
}

.btn-modern {
    font-size: var(--text-xs);
    font-weight: 500;
    border-radius: var(--radius);
    padding: var(--space-1) var(--space-2);
    border: 1px solid transparent;
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    line-height: 1.2;
}

.btn-primary-modern {
    background: var(--primary);
    color: var(--white);
}

.btn-primary-modern:hover {
    background: var(--primary-dark);
    color: var(--white);
}

.btn-success-modern {
    background: var(--success);
    color: var(--white);
}

.btn-success-modern:hover {
    background: #047857;
    color: var(--white);
}

.btn-warning-modern {
    background: var(--warning);
    color: var(--white);
}

.btn-warning-modern:hover {
    background: #b45309;
    color: var(--white);
}


.btn-outline-modern {
    background: var(--white);
    color: var(--primary);
    border-color: var(--primary);
}

.btn-outline-modern:hover {
    background: var(--primary);
    color: var(--white);
}

.btn-light-modern {
    background: var(--gray-100);
    color: var(--gray-700);
    border-color: var(--gray-200);
}

.btn-light-modern:hover {
    background: var(--gray-200);
    color: var(--black);
}

.btn-sm-modern {
    font-size: var(--text-xs);
    padding: var(--space-1) var(--space-2);
}

.status-badge {
    font-size: var(--text-xs);
    font-weight: 600;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-badge.active { 
    background: var(--success-light); 
    color: var(--success); 
}

.status-badge.inactive { 
    background: var(--gray-200); 
    color: var(--gray-600); 
}

.category-badge {
    font-size: var(--text-xs);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius);
    background: var(--primary-light);
    color: var(--primary-dark);
}

.search-filters {
    background: var(--white);
    border: var(--border);
    border-radius: var(--radius);
    padding: var(--space-4);
    margin-bottom: var(--space-4);
}
.round-lg{
    border-radius:8px !important;
}
</style>
{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-center">
            <h1 class="page-title">
                
                Service Charges
            </h1>
            <p class="page-subtitle">Manage billing services and pricing</p>
        </div>
        <div class="header-actions">
            <a href="{% url 'billing:service_create' %}" class="button-min-primary">
               <div>
                <i class="fa fa-plus me-2"></i>
                Add
               </div>
            </a>
        </div>
    </div>

    <!-- Search & Filters -->
    <div class="search-filters">
        <form method="get" class="form-row">
            <div class="form-group">
                <label for="search" class="form-label">Search</label>
                <input type="text" id="search" name="search" class="form-control h-8 round-lg" 
                       placeholder="Service name, description..." 
                       value="{{ request.GET.search }}">
            </div>
            <div class="form-group">
                <label for="category" class="form-label">Category</label>
                <select id="category" name="category" class="form-control h-8 round-lg">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                    <option value="{{ category }}" {% if request.GET.category == category %}selected{% endif %}>
                        {{ category }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="is_active" class="form-label">Status</label>
                <select id="is_active" name="is_active" class="form-control h-8 round-lg">
                    <option value="">All Services</option>
                    <option value="true" {% if request.GET.is_active == 'true' %}selected{% endif %}>Active Only</option>
                    <option value="false" {% if request.GET.is_active == 'false' %}selected{% endif %}>Inactive Only</option>
                </select>
            </div>
            <div class="form-group">
                <button type="submit" class="button-min-primary">
                    <div>
                        <i class="bi bi-search me-1"></i>
                        Search
                    </div>
                </button>
            </div>
        </form>
    </div>

    <!-- Services Table -->
    <div class="service-table-container">
        <table class="service-table">
            <thead>
                <tr>
                    <th>Service Code</th>
                    <th>Service Name</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for service in services %}
                <tr>
                    <td>
                        {% if service.service_code %}
                            <strong class="text-primary">{{ service.service_code }}</strong>
                        {% else %}
                            <span class="text-muted">No Code</span>
                        {% endif %}
                    </td>
                    <td>
                        <strong>{{ service.name }}</strong>
                        {% if service.description %}
                            <br><small class="text-muted">{{ service.description|truncatechars:50 }}</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if service.category %}
                            <span class="category-badge rounded px-2">{{ service.get_category_display }}</span>
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td>
                        <strong>${{ service.default_price|floatformat:2 }}</strong>
                    </td>
                    <td>
                        <span class="status-badge rounded px-2 {% if service.is_active %}active{% else %}inactive{% endif %}">
                            {% if service.is_active %}Active{% else %}Inactive{% endif %}
                        </span>
                    </td>
                    <td>
                        {{ service.created_at|date:"d/m/Y" }}
                    </td>
                    <td>
                        <div class="d-flex gap-1">
                            <a href="{% url 'billing:service_edit' service.id %}" 
                               class="button-min-default px-2 py-1" 
                               title="Edit Service">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <a href="{% url 'billing:service_history' service.id %}" 
                               class="button-min-primary px-2 py-1" 
                               title="View Change History">
                                <i class="bi bi-clock-history"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: var(--space-8); color: var(--gray-500);">
                        <div class="">
                            <i class="bi bi-gear" style="font-size: 2rem; color: var(--gray-300); margin-bottom: var(--space-2);"></i>
                            <p>No services found.</p>
                           <div class="flex w-full justify-center mt-3">
                            <a href="{% url 'billing:service_create' %}" class="button-min-primary px-5">
                                <div>
                                 <i class="fa fa-plus me-1"></i>
                                 Add
                                </div>
                             </a>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if services.has_other_pages %}
    <div class="pagination-container">
        <div class="pagination">
            {% if services.has_previous %}
                <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.is_active %}&is_active={{ request.GET.is_active }}{% endif %}">« First</a>
                <a href="?page={{ services.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.is_active %}&is_active={{ request.GET.is_active }}{% endif %}">‹ Previous</a>
            {% endif %}

            <span class="current">
                Page {{ services.number }} of {{ services.paginator.num_pages }}
            </span>

            {% if services.has_next %}
                <a href="?page={{ services.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.is_active %}&is_active={{ request.GET.is_active }}{% endif %}">Next ›</a>
                <a href="?page={{ services.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.is_active %}&is_active={{ request.GET.is_active }}{% endif %}">Last »</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %} 