{% extends 'base/base.html' %}
{% load static %}

{% block title %}Extension Edit Form - {{ worker.get_full_name }}{% endblock %}

{% block extra_css %}
<link href="{% static 'vendor/fonts/google-fonts.css' %}" rel="stylesheet">
<script src="{% static 'js/tailwindcss.js' %}"></script>
<style>

/* Extension Edit Form - Print Preview Style */
:root {
    --primary: #3b82f6;
    --success: #10b981;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-500: #6b7280;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    --white: #ffffff;
}

.moul-regular {
    font-family: "Moul", serif;
}
.time-roman{
    font-family: "Roboto Slab", serif;
    font-style: normal;
}
.noto-sans-sc-500 {
    font-family: "Noto Sans SC", sans-serif;
    font-optical-sizing: auto;
    font-weight: 500;
    font-style: normal;
}
.kh-content-regular {
    font-family: "Content", system-ui;
    font-weight: 400;
    font-style: normal;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--gray-50);
    font-size: 12px;
}

.edit-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 12px;
}

/* Compact Header */
.edit-header {
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: 4px;
    margin-bottom: 8px;
    padding: 8px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.edit-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--gray-900);
    margin: 0;
}

.edit-subtitle {
    font-size: 10px;
    color: var(--gray-500);
    margin: 2px 0 0 0;
}

.btn-edit {
    padding: 4px 8px;
    font-size: 10px;
    font-weight: 500;
    border: 1px solid var(--gray-300);
    background: var(--white);
    color: var(--gray-700);
    text-decoration: none;
    border-radius: 3px;
    display: inline-flex;
    align-items: center;
    gap: 3px;
    transition: all 0.1s;
}

.btn-edit:hover {
    background: var(--gray-50);
    border-color: var(--gray-400);
}

.btn-edit.primary {
    background: var(--primary);
    border-color: var(--primary);
    color: var(--white);
}

.btn-edit.success {
    background: var(--success);
    border-color: var(--success);
    color: var(--white);
}

/* Compact Form Container */
.form-container {
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: 4px;
    padding: 16px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

/* Compact Official Header */
.official-header {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin-bottom: 12px;
    font-size: 10px;
}

.header-section {
    text-align: center;
    flex: 1;
}

.header-section h2 {
    margin: 0;
    font-size: 11px;
}

.header-section h3 {
    margin: 2px 0;
    font-size: 9px;
}

/* Compact Form Title */
.form-title-section {
    text-align: center;
    margin: 12px 0;
}

.form-title-section h2,
.form-title-section h3 {
    margin: 4px 0;
}

.form-title-section h2 {
    font-size: 11px;
}

.form-title-section h3 {
    font-size: 10px;
}

.title-divider {
    width: 60px;
    height: 1px;
    border-bottom: 1px dashed var(--gray-300);
    margin: 8px auto;
}

/* Compact Photo Section */
.photo-section {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin: 8px 0;
    gap: 12px;
}

.photo-instructions {
    flex: 1;
    font-size: 9px;
}

.photo-box {
    width: 60px;
    height: 72px;
    border: 1px solid var(--gray-300);
    background: var(--white);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: 8px;
    color: var(--gray-600);
}

.photo-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Compact Form Fields */
.form-field-group {
    margin: 8px 0;
}

.field-header {
    display: flex;
    align-items: center;
    gap: 4px;
    font-weight: 500;
    margin-bottom: 4px;
    font-size: 10px;
}

.field-row {
    display: flex;
    align-items: end;
    gap: 6px;
    margin-bottom: 2px;
}

.field-label {
    font-size: 9px;
    font-weight: 500;
    color: var(--gray-700);
    min-width: fit-content;
}

.field-underline {
    flex: 1;
    border-bottom: 1px dashed var(--gray-400);
    height: 16px;
    position: relative;
}

.field-input {
    width: 100%;
    border: 1px solid var(--gray-300);
    border-radius: 3px;
    padding: 4px 6px;
    font-size: 11px;
    background: var(--white);
    color: var(--gray-900);
    transition: all 0.1s;
}

.field-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.1);
}

.field-select {
    width: 100%;
    border: 1px solid var(--gray-300);
    border-radius: 3px;
    padding: 4px 6px;
    font-size: 11px;
    background: var(--white);
    color: var(--gray-900);
}

.field-textarea {
    width: 100%;
    border: 1px solid var(--gray-300);
    border-radius: 3px;
    padding: 4px 6px;
    font-size: 11px;
    background: var(--white);
    color: var(--gray-900);
    min-height: 50px;
}

/* Compact Layouts */
.two-column {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.three-column {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 8px;
}

/* Compact Checkbox Options */
.checkbox-options {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin: 6px 0;
}

.checkbox-option {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 9px;
}

.checkbox-option input[type="checkbox"],
.checkbox-option input[type="radio"] {
    width: 12px;
    height: 12px;
    border: 1px solid var(--gray-400);
}

/* Compact Section Divider */
.section-divider {
    border-bottom: 1px solid var(--gray-300);
    margin: 12px 0;
}

/* Compact Action Bar */
.action-bar {
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-radius: 4px;
    padding: 8px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
}

.action-left {
    font-size: 9px;
    color: var(--gray-500);
    display: flex;
    align-items: center;
    gap: 4px;
}

.action-right {
    display: flex;
    gap: 6px;
}

.help-text {
    font-size: 11px;
    color: var(--gray-500);
    margin-top: 4px;
}

/* Ultra Compact Responsive */
@media (max-width: 768px) {
    .edit-container {
        padding: 8px;
    }
    
    .form-container {
        padding: 8px;
    }
    
    .official-header {
        flex-direction: column;
        gap: 4px;
        font-size: 8px;
    }
    
    .photo-section {
        flex-direction: column;
        align-items: center;
        gap: 6px;
    }
    
    .two-column,
    .three-column {
        grid-template-columns: 1fr;
        gap: 4px;
    }
    
    .checkbox-options {
        flex-direction: column;
        gap: 6px;
    }
    
    .form-field-group {
        margin: 4px 0;
    }
}
</style>
{% endblock %}

{% block content %}
<div>
    <!-- Edit Header -->
    <div class="mx-auto w-[90%] flex justify-between items-center py-3 border-b border-gray-200">
        <a href="{% url 'eform:extension_requests_list' %}" class="flex items-center space-x-2">
         
          <span>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
              </svg>                  
          </span>
          <span class="text-sm">Back</span>
        </a>
        <div>
            <h1 class="text-sm text-gray-700 font-medium"> Extension of Stay Application Form  </h1>
            <p class="edit-subtitle">Editing for {{ worker.get_full_name }} • {{ form_date|date:"d/m/Y" }}</p>
        </div>
    </div>
    

    <!-- Form Container -->
    <div class="rounded-lg relative border border-gray-100 w-[250mm] min-h-[297mm] h-auto bg-white mx-auto mt-3 p-8 print:w-[230mm] print:p-0 print:m-0 print:border-none">
        <!-- Header -->
      <div class="flex justify-between w-full print:w-full">
        <div class=" text-center space-y-1">
            <div class="space-y-1">
                <h2 class="moul-regular text-[14px]">ក្រសួងមហាផ្ទៃ</h2>
                <h3 class="time-roman text-[14px]">Ministry of Interior / 内政部</h3>
            </div>
          
          <div class="space-y-1">
            <h2 class="moul-regular text-[14px]">អគ្គនាយកដ្ឋានអន្តោប្រវេសន៍</h2>
            <h3 class="time-roman text-[14px]">General Department of Immigration / 移民总局</h3>
          </div>
  
        </div>
      
        <div class=" text-center space-y-1">
            <div class="space-y-1">
                <h2 class="moul-regular text-[14px]">ព្រះរាជាណាចក្រកម្ពុជា</h2>
                <h3 class="time-roman text-[14px]">Kingdom of Cambodia / 柬埔寨王国</h3>
            </div>
          
          <div class="space-y-1">
            <h2 class="moul-regular text-[14px]">ជាតិ សាសនា ព្រះមហាក្សត្រ</h2>
            <h3 class="time-roman text-[14px]">Nation Religion King / 国家 宗教 国王</h3>
          </div>
  
        </div>
      </div>

      <!-- Title -->
      <div class="w-full mt-5 text-center space-y-1.5 ">
        <h2 class="moul-regular text-[14px]">ពាក្យស្នើសុំបន្តការស្នាក់នៅបណ្ដោះអាសន្ន</h2>
        <h3 class="time-roman text-[14px] font-semibold">Extension of Stay Application Form</h3>
        <h3 class="noto-sans-sc-500 text-[14px]">延长逗留期限申请表</h3>
        <div class="w-full flex justify-center mt-2">
            <div class="border-b-2 border-dashed border-gray-600 w-[10%]"></div>
        </div>
      </div>
      <!-- Title -->

        <!-- Form -->
        <form method="post" enctype="multipart/form-data" id="extensionForm">
            {% csrf_token %}
            
            
            <!-- photo box -->
            <div class="mt-5 flex justify-between pt-1 relative">
                <div class=" space-y-0.5 flex-1">
                    <h2 class="kh-content-regular text-[12px]">សូមបំពេញព័ត៌មានខាងក្រោមជាភាសាអង់គ្លេស</h2>
                    <h2 class="time-roman text-[14px]">Please fill in the following information in English / 请用英文填写以下信息</h2>
                </div>
                <div class="flex-shrink-0 ml-4">
                    <div class="border border-gray-300 w-[96px] h-[116px] bg-white">
                      <div class="flex flex-col justify-center items-center text-sm h-full text-gray-600">
                        <span class="text-xs"> រូបថត</span>
                        <span class="font-semibold">PHOTO</span>
                         <span class="text-xs">4 x 6</span>
                     </div>
                        {% comment %} {% if worker.professional_photo %}
                        <img src="{% url 'zone:serve_worker_photo' worker.id %}"
                          style="width: 96px; height: 116px; object-fit: cover"
                          alt="Worker Photo"
                          class="extension-edit-photo"
                          onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                      />
                       
                        {% elif worker.photo %}
                        <img src="{% url 'zone:serve_worker_photo' worker.id %}"
                          style="width: 96px; height: 116px; object-fit: cover"
                          alt="Worker Photo"
                          class="extension-edit-photo"
                          onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                        />
                        
                        {% else %}
                        <div class="flex flex-col justify-center items-center text-sm h-full text-gray-800">
                          <span class="text-xs"> រូបថត</span>
                          <span class="font-semibold">PHOTO</span>
                              <span class="text-xs">4 x 6</span>
                          </div>
                        {% endif %} {% endcomment %}
                    </div>
                </div>
            </div>
            <!-- photo box -->

            <!-- Personal Information -->
            
            <div class="mt-2 relative">
                <div class="w-full relative">
                    <div class="flex items-center space-x-2 font-medium">
                        <span class="-mt-1">-</span>
                        <span class="kh-content-regular text-[14px]">នាម</span>
                    </div>
                    <div class="flex justify-start items-end space-x-2 mt-0">
                        <span class="text-[12px] time-roman ml-4 font-medium w-[100px]">Surname / 姓 :</span>
                        <span class="w-full border-b border-dashed border-gray-500"></span>
                        <div class="absolute left-[13%] pb-1 w-[86%]">
                            <input type="text" class="w-full outline-none time-roman  bg-gray-100 py-0.5 px-2 !text-[14px] font-semibold  print:left-[15%]" name="surname" value="{{ worker.last_name }}" readonly />
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-2 relative">
                <div class="w-full relative">
                    <div class="flex items-center space-x-2 font-medium">
                        <span class="-mt-1">-</span>
                        <span class="kh-content-regular text-[14px]">គោត្តនាម</span>
                    </div>
                    <div class="flex justify-start items-end space-x-2 mt-0">
                        <span class="text-[12px] time-roman ml-4 font-medium w-[120px]">Given Name / 名:</span>
                        <span class="w-full border-b border-dashed border-gray-500"></span>
                        <div class="absolute left-[15%] pb-1 w-[86%]">
                            <input type="text" class="w-full bg-gray-100 py-0.5 px-2 outline-none time-roman !text-[14px] font-semibold print:left-[15%]" name="given_name" value="{{ worker.first_name }}" readonly />
                        </div>

                    </div>
                </div>
            </div>

            

            <!-- Birth Date and Nationality -->

            <div class="w-full mt-4 flex justify-between items-start">
                <div>
                    <div class="flex items-center space-x-2 font-medium">
                        <span class="-mt-1">-</span>
                        <span class="kh-content-regular text-[14px]">ថ្ងៃ ខែ ឆ្នាំកំណើត</span>
                    </div>
                    <div class="flex justify-start items-end space-x-2 mt-1">
                        <span class="text-[12px] time-roman ml-4 font-medium w-[290px]">Date of birth / 出生日期 :</span>
                        <span class="w-full border-b border-dashed border-gray-500"></span>
                        <span class=" time-roman text-[14px] font-semibold absolute left-[20.5%] print:left-[20%] pb-1">
                            <input type="date" class="border-none outline-none bg-gray-100 py-0.5 px-2" name="date_of_birth" 
                            value="{{ worker.dob|date:'Y-m-d' }}" readonly >
                        </span>
                    </div>
                </div>
                <div class="relative print:-ml-9">
                  <div class="flex items-start space-x-2 font-medium ">
                    <span class="kh-content-regular text-[14px]">សញ្ជាតិ</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                    <span class="text-[12px] time-roman font-medium w-[220px]">Nationality / 国籍 :</span>
                    <span class="w-full border-b border-dashed border-gray-500"></span>
                    <span class="w-[50%] time-roman text-[14px] font-semibold absolute left-[49%] pb-1">
                        <input type="text" class="w-full border-none outline-none bg-gray-100 py-0.5 px-2" name="nationality" 
                        value="{{ worker.get_nationality_display }}" readonly />
                    </span>
                </div>
                </div>
                <div class="flex space-x-5 print:space-x-2 ">
                  <div>
                    <div class="flex items-center space-x-2 font-medium ">
                      <span class="kh-content-regular text-[14px]">ភេទ</span>
                    </div>
                    <div class="flex justify-start items-end space-x-2 mt-0">
                        <span class="text-[12px] time-roman font-medium">Sex / 性别 :</span>
                    </div>
                  </div>
                  <div>
                    <div class="flex items-center space-x-2 font-medium ">
                      <span class="kh-content-regular text-[14px]">ប្រុស</span>
                      <div class="border w-3 h-3 flex items-center justify-center">
                        {% if worker.sex == "M" %}
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-3">
                          <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                        </svg>  
                        <input type="radio" name="gender" value="M" class="hidden" {% if worker.sex == "M" %} checked {% endif %} disabled>
                        {% endif %}   
                                      
                      </div>
                      
                    </div>
                    <div class="flex justify-start items-end space-x-2 mt-0">
                        <span class="text-[12px] time-roman font-medium ">Male / 男性</span>
                    </div>
                  </div>
                  <div>
                    <div class="flex items-center space-x-2 font-medium ">
                      <span class="kh-content-regular text-[14px]">ស្រី</span>
                      
                      <div class="border w-3 h-3 flex items-center justify-center">
                        {% if worker.sex == "F" %}
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-3">
                          <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                        </svg>  
                        <input type="radio" name="gender" value="F" class="hidden" {% if worker.sex == "F" %} checked {% endif %} disabled>   
                        {% endif %} 
                       
                      </div>
                      
                    </div>
                    <div class="flex justify-start items-end space-x-2 mt-0">
                        <span class="text-[12px] time-roman font-medium ">Female / 女性</span>
                    </div>
                  </div>
                </div>
          </div>

            
            

            <!-- Passport Information -->

            <div class="w-full mt-4 flex justify-between items-start ">
                <div>
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="-mt-1">-</span>
                    <span class="kh-content-regular text-[14px]">លេខលិខិតឆ្លងដែន</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman ml-4 font-medium w-[290px]">Passport No / 护照号码 :</span>
                      <span class="w-full border-b border-dashed border-gray-500"></span>
                      <span class="w-[17%] time-roman text-[14px] font-semibold absolute left-[20.5%] print:left-[20%] pb-1">
                        <input type="text" class="w-full border-none outline-none bg-gray-100 py-0.5 px-2 " name="passport_number" value="{{ form_data.passport_number | default:"Input here" }}" required>
                      </span>
                  </div>
                </div>
        
                <div class=" relative">
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="kh-content-regular text-[14px]">ចេញថ្ងៃ</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman font-medium w-[230px]">Isussed / 伊苏塞德 :</span>
                      <span class="w-full border-b border-dashed border-gray-500"></span>
                      <span class="w-[53%] time-roman text-[14px] font-semibold absolute left-[45%] pb-1">
                        <input type="date" class="w-full border-none outline-none  bg-gray-100 py-0.5 px-2" name="passport_issued_date" 
                                   value="{{ form_data.passport_issued_date|date:'Y-m-d' }}">
                      </span>
                  </div>
                  
                </div>
                <div class=" relative">
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="kh-content-regular text-[14px]">ផុតកំណត់ថ្ងៃ</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman font-medium w-[210px]">Expiration / 过期 :</span>
                      <span class="w-full border-b border-dashed border-gray-500"></span>
                      <span class="w-[53%] time-roman text-[14px] font-semibold absolute left-[45%] print:left-[51%] pb-1">
                        <input type="date" class="w-full border-none outline-none pr-0  bg-gray-100 py-0.5 px-2" name="passport_expiry_date" 
                                   value="{{ form_data.passport_expiry_date|date:'Y-m-d' }}">
                      </span>
                  </div>
                  
                </div>
              </div>

            

            <div class="w-full border-b-2 border-gray-500 py-2"></div>

            <!-- Current Visa Information -->

            <div class="w-full mt-4 flex justify-start items-start space-x-5">
                <div>
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="-mt-1">-</span>
                    <span class="kh-content-regular text-[14px]">លេខទិដ្ឋាការ</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman ml-4 font-medium w-[330px]">Current Visa No / 签证号码 :</span>
                      <span class="w-full border-b border-dashed border-gray-500"></span>
                      <span class="time-roman text-[14px] font-semibold absolute left-[22.5%] pb-1 print:left-[20%]">
                        <input type="text" class="w-full flex bg-gray-100 px-2 py-0.5 border-none" name="current_visa_number" 
                                   value="{{ form_data.current_visa_number }}">
                      </span>
                  </div>
                </div>
        
                <div class=" relative w-full">
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="kh-content-regular text-[14px]">ថ្ងៃចេញ</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman font-medium w-[190px]">Visa Expiry / 签证到期 :</span>
                      <span class="w-full border-b border-dashed"></span>
                      <span class="w-[70%] time-roman text-[14px] font-semibold absolute left-[29%] pb-1">
                        <input type="date" class="bg-gray-100 border-none w-full px-2 py-1" name="current_visa_expiry" 
                        value="{{ form_data.current_visa_expiry|date:'Y-m-d' }}">
                      </span>
                  </div>
                </div>
                
            </div>

            <div class="w-full mt-3 flex justify-start items-start space-x-5">
                <div class="w-full relative">
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="-mt-1">-</span>
                    <span class="kh-content-regular text-[14px]">ថ្ងៃចូលកម្ពុជា</span>
                  </div>
                  <div class="w-full flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman ml-4 font-medium w-[270px]">Entry Date to Cambodia / 入境日期 :</span>
                      <span class="w-full border-b border-dashed border-gray-500"></span>
                       <span class="w-[74%] time-roman text-[14px] font-semibold absolute left-[25.5%] pb-1 print:left-[20%]">
                        <input type="date" class="bg-gray-100 border-none w-full px-2 py-1" name="entry_date" 
                        value="{{ form_data.entry_date|date:'Y-m-d' }}">
                      </span>
                  </div>
                </div>
        
                
            </div>

            

            <!-- Extension Period Selection -->
            <div class="w-full mt-4 flex justify-start items-start space-x-5">
                <div>
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="-mt-1">-</span>
                    <span class="kh-content-regular text-[14px]">ស្នើសុំបន្តតការស្នាក់នៅរយពេល</span>
                  </div>
                  <div class="flex justify-start items-start space-x-2 mt-1 w-full">
                      <span class="text-[12px] time-roman ml-4 font-medium w-[360px]">Apply for Permission of Stay on / 签证号码 :</span>
                      <div class="w-full grid grid-cols-4 gap-2 -mt-4">
                         <div>
                           
                            <label for="m1" class="kh-content-regular text-[14px]">១ខែ</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="m1" class="text-[12px] time-roman font-medium ">1 month / 个月</label>
                              <input type="radio" id="m1" name="extension_months" value="1" onchange="updateDurationFromMonths(1)">
                            </div>
                          </div>
                          <div>
                            <label for="m3" class="kh-content-regular text-[14px]">៣ខែ</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="m3" class="text-[12px] time-roman font-medium ">3 month / 个月</label>
                              <input type="radio" id="m3" name="extension_months" value="3" onchange="updateDurationFromMonths(3)">
                             
                            </div>
                          </div>
                          <div>
                            <label for="m6" class="kh-content-regular text-[14px]">៦ខែ</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="m6" class="text-[12px] time-roman font-medium ">6 month / 个月</label>
                              <input type="radio" id="m6" name="extension_months" value="6" onchange="updateDurationFromMonths(6)">

                            </div>
                          </div>
                          <div>
                            <label for="m12" class="kh-content-regular text-[14px]">១២ខែ</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="m12" class="text-[12px] time-roman font-medium ">12 month / 个月</label>
                              <input type="radio" id="m12" name="extension_months" value="12" onchange="updateDurationFromMonths(12)" checked/>
                             
                            </div>
                          </div>
                          <div>
                            <label for="m24" class="kh-content-regular text-[14px]">២៤ខែ</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="m24" class="text-[12px] time-roman font-medium ">24 month / 个月</label>
                              <input type="radio" id="m24" name="extension_months" value="24" onchange="updateDurationFromMonths(24)"/>
                               
                            </div>
                          </div>
                      </div>
                      
                  </div>
                </div>      
            </div>

            
            <!-- Purpose of Stay -->
            <div class="w-full mt-4 flex justify-start items-start space-x-5">
                <div>
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="-mt-1">-</span>
                    <span class="kh-content-regular text-[14px]">គោលបំណងនៃការស្នាក់នៅ</span>
                  </div>
                  <div class="flex justify-start items-start space-x-2 mt-1 w-full">
                      <span class="text-[12px] time-roman ml-4 font-medium w-[200px]">Purpose of Stay / 居住目的 :</span>
                      <div class="w-full grid grid-cols-3 gap-2 -mt-4">
                         <div>
                           
                            <label for="p1" class="kh-content-regular text-[12px]">ការវិនិយោគ</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="p1" class="text-[12px] time-roman font-medium ">Investment / 投资</label>
                              <input type="radio" id="p1" name="extension_reason" value="investment"/>
                            </div>
                          </div>
                          <div>
                            <label for="p2" class="kh-content-regular text-[12px]">អាជីវកម្ម</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="p2" class="text-[12px] time-roman font-medium ">Business / 商业</label>
                              <input type="radio" id="p2" name="extension_reason" value="business" />
                             
                            </div>
                          </div>
                          <div>
                            <label for="p3" class="kh-content-regular text-[12px]">ការងារការិយាល័យ</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="p3" class="text-[12px] time-roman font-medium ">Office Work / 办公室工作</label>
                              <input type="radio" id="p3" name="extension_reason" value="employment" />

                            </div>
                          </div>
                          <div>
                            <label for="p4" class="kh-content-regular text-[12px]">ការងារជំនាញ</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="p4" class="text-[12px] time-roman font-medium ">Professional Work / 专业工作</label>
                              <input type="radio" id="p4" name="extension_reason" value="professional" />
                             
                            </div>
                          </div>
                          <div>
                            <label for="p5" class="kh-content-regular text-[12px]">ប្រកបរបរផ្ទាល់ខ្លួន</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="p5" class="text-[12px] time-roman font-medium ">Personal Occupation / 个人职业</label>
                              <input type="radio" id="p5" name="extension_reason" value="family" />
                               
                            </div>
                          </div>
                          <div>
                            <label for="p6" class="kh-content-regular text-[12px]">ទេសចរណ៍</label>
                            <div class="flex justify-start items-center space-x-2 -mt-1">
                              <label for="p6" class="text-[12px] time-roman font-medium ">Tourism / 旅游</label>
                              <input type="radio" id="p6" name="extension_reason" value="tourism" />
                               
                            </div>
                          </div>
                          
                      </div>
                      
                      
                  </div>
                  <div class="w-full flex items-center justify-start mt-2">
                    <div class="w-[240px] ">
                    </div>
                    <div class="w-full">
                       
                        <label for="p7" class="kh-content-regular text-[12px] ml-5">ផ្សេងៗ</label>
                        <div class="flex justify-start items-center space-x-2 -mt-1">
                        <input type="radio" id="p7" name="extension_reason" value="other" />
                          <label for="p7" class="text-[12px] time-roman font-medium w-[110px]">Other / 其他:</label>
                          <input type="text" class="border-none bg-gray-100 px-2 py-2 w-[100%] -mt-2" name="other_reason_text" placeholder="Specify other reason">
                        </div>
                     </div>
                  </div>
                  
                  
                </div>      
            </div>
            

            <!-- Organization Information -->

            <div class="w-full mt-4 flex justify-start items-start space-x-5">
                <div class="relative w-full">
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="-mt-1">-</span>
                    <span class="kh-content-regular text-[14px]">ឈ្មោះគ្រិះស្ថាន/អង្កការ</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman ml-4 font-medium w-[410px]">Institution/Organization Name / 机构/组织名称 :</span>
                      <span class="w-full border-b border-dashed border-gray-500"></span>
                      <span class="w-[66%] time-roman text-[14px] font-semibold absolute left-[33%] pb-1 print:left-[20%]">
                        <input type="text" class="w-full flex bg-gray-100 px-2 py-0.5 border-none"  name="organization_name"
                        value="{{ form_data.organization_name|default:'KOH KONG RESORT' }}">
                      </span>
                  </div>
                </div>
                
            </div>
            <div class="w-full mt-4 flex justify-start items-start space-x-5">
                <div class="relative w-full">
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="-mt-1">-</span>
                    <span class="kh-content-regular text-[14px]">តួនាទី</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman ml-4 font-medium w-[110px]">Position / 位置 :</span>
                      <span class="w-full border-b border-dashed border-gray-500"></span>
                      <span class="w-[85%] time-roman text-[14px] font-semibold absolute left-[14%] pb-1 print:left-[20%]">
                        <input type="text" class="w-full flex bg-gray-100 px-2 py-0.5 border-none"  name="position"
                        value="{{ form_data.position|default:worker.position.name|default:'DEALER INSPECTOR' }}">
                      </span>
                  </div>
                </div>
            </div>
            

           

            <div class="w-full border-b-2 border-gray-500 py-2"></div>

            <!-- Work Permit Information -->

            <div class="w-full mt-4 flex justify-start items-start space-x-5">
                <div>
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="-mt-1">-</span>
                    <span class="kh-content-regular text-[14px]">បណ្ណការងារជនបរទេស លេខ</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman ml-4 font-medium w-[350px]">Working Permit / 工作许可证 :</span>
                      <span class="w-full border-b border-dashed border-gray-500"></span>
                      <span class="time-roman text-[14px] font-semibold absolute left-[23.5%] pb-1 print:left-[20%]">
                        <input type="text" class="w-full flex bg-gray-100 px-2 py-0.5 border-none" name="work_permit_number" 
                        value="{{ form_data.work_permit_number }}" />
                      
                      </span>
                  </div>
                </div>
        
                <div class=" relative w-full">
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="kh-content-regular text-[14px]">ថ្ងៃផុតកំណត់</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman font-medium w-[210px]">Expired Date / 失效日期 :</span>
                      <span class="w-full border-b border-dashed"></span>
                      <span class="w-[66%] time-roman text-[14px] font-semibold absolute left-[32%] pb-1">
                        <input type="date" class="bg-gray-100 border-none w-full px-2 py-1" name="work_permit_expiry" 
                        value="{{ form_data.work_permit_expiry|date:'Y-m-d' }}" />
                      </span>
                  </div>
                </div>
                
            </div>

            
            <!-- Address Information -->
            <div class="w-full mt-4 flex justify-start items-start space-x-5">
                <div class="relative w-full">
                  <div class="flex items-center space-x-2 font-medium">
                    <span class="-mt-1">-</span>
                    <span class="kh-content-regular text-[14px]">អាសយដ្ឋានស្នាក់នៅកម្ពុជា ឈ្មោះទីកន្លែងស្នាក់នៅ</span>
                  </div>
                  <div class="flex justify-start items-end space-x-2 mt-0">
                      <span class="text-[12px] time-roman ml-4 font-medium w-[410px]"> Address in Cambodia / 柬埔寨地址<br>
                        Name of Address / 收件人姓名:</span>
                      <span class="w-full border-b border-dashed border-gray-500"></span>
                     <span class="w-[66%] time-roman text-[14px] font-semibold absolute left-[33%] pb-1 print:left-[20%]">
                        <input type="text" class="w-full flex bg-gray-100 px-2 py-0.5 border-none" name="address_name" 
                        value="{{ form_data.address_name }}" />
                      </span>
                     
                  </div>
                  <!-- Additional Address Fields -->
                  <div class="mt-3 ml-5">
                    <div class="grid grid-cols-2 gap-3 mt-2">
                      <div class="relative">
                        <div class="flex justify-start items-end space-x-2">
                          <span class="text-[12px] time-roman font-medium w-[120px]">House No / 房子号:</span>
                          <span class="w-full border-b border-dashed border-gray-500"></span>
                          <input type="text" name="house_no" class="absolute left-[120px] pb-1 w-[calc(100%-130px)] bg-gray-100 px-2 py-0.5 border-none time-roman text-[14px]"
                                 value="{{ form_data.house_no }}" placeholder="Enter house number"/>
                        </div>
                      </div>
                      <div class="relative">
                        <div class="flex justify-start items-end space-x-2">
                          <span class="text-[12px] time-roman font-medium w-[120px]">Street No / 街道号码:</span>
                          <span class="w-full border-b border-dashed border-gray-500"></span>
                          <input type="text" name="street_no" class="absolute left-[120px] pb-1 w-[calc(100%-130px)] bg-gray-100 px-2 py-0.5 border-none time-roman text-[14px]"
                                 value="{{ form_data.street_no }}" placeholder="Enter street number"/>
                        </div>
                      </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3 mt-4">
                      <div class="relative">
                        <div class="flex justify-start items-end space-x-2">
                          <span class="text-[12px] time-roman font-medium w-[120px]">Commune / 位置:</span>
                          <span class="w-full border-b border-dashed border-gray-500"></span>
                          <input type="text" name="commune" class="absolute left-[120px] pb-1 w-[calc(100%-130px)] bg-gray-100 px-2 py-0.5 border-none time-roman text-[14px]"
                                 value="{{ form_data.commune }}" placeholder="Enter commune/sangkat"/>
                        </div>
                      </div>
                      <div class="relative">
                        <div class="flex justify-start items-end space-x-2">
                          <span class="text-[12px] time-roman font-medium w-[120px]">District / 区:</span>
                          <span class="w-full border-b border-dashed border-gray-500"></span>
                          <input type="text" name="district" class="absolute left-[120px] pb-1 w-[calc(100%-130px)] bg-gray-100 px-2 py-0.5 border-none time-roman text-[14px]"
                                 value="{{ form_data.district }}" placeholder="Enter district/khan"/>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
            </div>
            

            <!-- Hidden Fields for System Processing -->
            <input type="hidden" name="extension_duration" id="extensionDurationHidden" value="{{ form_data.extension_duration|default:365 }}">
            <input type="hidden" name="extension_type" value="work">
            <input type="hidden" name="extension_start_date" value="{{ form_data.extension_start_date|date:'Y-m-d'|default:'' }}">
            <input type="hidden" name="status" value="{{ form_data.status|default:'requested' }}">
            <input type="hidden" name="current_visa_type" value="work">
            
            <!-- Additional Details -->
            <div class="form-field-group mt-3">
                <div class="field-header">
                    <span class="-mt-1">-</span>
                    <span class="time-roman text-sm ml-2">Additional Details / Comments</span>
                </div>
                <textarea class="mx-4 w-[97%] bg-gray-100 px-3 py-0.5" name="additional_details"
                          placeholder="Enter any additional information or special requests...">{{ form_data.additional_details }}</textarea>
            </div>

            <div class="w-full border-b-2 border-gray-500 py-2"></div>

            <!-- Service Selection -->
            <div class="form-field-group">
                <div class="field-header">
                    <span>-</span>
                    <span class="time-roman text-sm">Service Type / 服务类型</span>
                </div>
                <div class="field-row mt-2">
                    <span class="text-xs time-roman ml-2 mt-2">Extension Service:</span>
                    <div class="field-underline">
                        <select class="bg-gray-100 border w-full h-8 px-2 py-1 -mt-4" name="service" required>
                            <option value="">-- Select Service --</option>
                            {% for service in visa_services %}
                                <option value="{{ service.id }}"
                                    {% if form_data.service == service.id %}selected{% endif %}>
                                    {{ service.name }} - ${{ service.base_price }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

        </form>
    </div>

    <!-- Action Bar -->
    <div class="flex items-center gap-4 justify-between mx-5 mb-10 mt-3 px-1 border rounded py-2">
        <div class="text-xs text-blue-500 p-2 rounded-xs">
            <i class="bi bi-info-circle"></i>
            Save: Keep editing • Preview: View print format
        </div>
        <div class="flex items-center gap-3 pr-2">
            <a href="{% url 'eform:extension_requests_list' %}" class="button-min-danger flex">
               <div>
              
                <span>Cancel</span>
               </div>
            </a>
            <button type="submit" form="extensionForm" name="action" value="save" class="button-min-default flex space-x-2">
                <i class="bi bi-floppy"></i>
                Save
            </button>
            
            <button type="submit" form="extensionForm" name="action" value="preview" class="button-min-primary">
                <div class="space-x-1">
                    <i class="fas fa-eye text-xs"></i>
                    <span class="font-medium">Preview</span>
                </div>
            </button>
        </div>
    </div>
</div>

<script>
function updateDurationFromMonths(months) {
    const days = months * 30; // Approximate days per month
    document.getElementById('extensionDurationHidden').value = days;
    
    // Update the start date to current date
    const today = new Date().toISOString().split('T')[0];
    document.querySelector('[name="extension_start_date"]').value = today;
}

// Pre-select based on existing data
document.addEventListener('DOMContentLoaded', function() {
    const currentDuration = parseInt('{{ form_data.extension_duration|default:365 }}') || 365;
    const approximateMonths = Math.round(currentDuration / 30);
    
    // Select the appropriate radio button
    const monthRadio = document.querySelector('[name="extension_months"][value="' + approximateMonths + '"]');
    if (monthRadio) {
        monthRadio.checked = true;
    } else if (currentDuration >= 365) {
        const yearRadio = document.querySelector('[name="extension_months"][value="12"]');
        if (yearRadio) {
            yearRadio.checked = true;
        }
    }
    
    // Pre-select reason
    const currentReason = '{{ form_data.extension_reason|default:"employment" }}';
    const reasonRadio = document.querySelector('[name="extension_reason"][value="' + currentReason + '"]');
    if (reasonRadio) {
        reasonRadio.checked = true;
    }
    
    // Add form submission
    const form = document.querySelector('form');
    const submitButton = document.querySelector('.btn-edit.success');
    
    if (submitButton) {
        submitButton.addEventListener('click', function(e) {
            e.preventDefault();
            form.submit();
        });
    }
    
    // Set today's date as default start date if empty
    const startDateField = document.querySelector('[name="extension_start_date"]');
    if (!startDateField.value) {
        const today = new Date().toISOString().split('T')[0];
        startDateField.value = today;
    }

    // Handle image load errors for extension edit form photos
    document.querySelectorAll('img.extension-edit-photo').forEach(function(img) {
        img.addEventListener('error', function() {
            console.log('Extension edit form photo failed to load:', this.src);
            
            // Hide the broken image and show placeholder
            this.style.display = 'none';
            let placeholder = this.nextElementSibling;
            if (placeholder) {
                placeholder.style.display = 'flex';
            }
        });
        
        // Check for corrupted images that appear to load but have no dimensions
        img.addEventListener('load', function() {
            if (this.naturalWidth === 0 || this.naturalHeight === 0) {
                this.style.display = 'none';
                let placeholder = this.nextElementSibling;
                if (placeholder) {
                    placeholder.style.display = 'flex';
                }
            }
        });
    });
});
</script>
{% endblock %} 