{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ title }} - Zone Management{% endblock %}

{% block main_class %}col-md-10 ms-sm-auto col-lg-10{% endblock %}

{% block extra_css %}
<style>
.form-section {
    border: 1px solid #dee2e6;
    padding: 8px;
    margin-bottom: 8px;
    background-color: #f8f9fa;
    border-radius: 3px;
}
.form-section h4 {
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 6px;
    color: #495057;
    text-transform: uppercase;
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 3px;
}
.required-field {
    color: #dc3545;
}
.form-label {
    font-size: 11px !important;
    margin-bottom: 2px !important;
    font-weight: 500;
}
.form-control, .form-select {
    font-size: 12px !important;
    padding: 6px 8px !important;
    height: auto !important;
    border-radius: 5px;
    border:1px solid #dee2e6;
}
.row.g-1 {
    --bs-gutter-x: 0.25rem;
    --bs-gutter-y: 0.25rem;
}
.btn {
    font-size: 12px;
    padding: 6px 12px;
}
.btn-sm {
    font-size: 11px;
    padding: 4px 8px;
}
/* Compact submit button area */
.submit-buttons {
    margin-top: 16px;
    padding-top: 12px;
    border-top: 1px solid #dee2e6;
}
/* Form section hover effect */
.form-section:hover {
    background-color: #f1f3f4;
}
/* Textarea styling */
textarea.form-control {
    resize: vertical;
    min-height: 60px;
}
.form-check-input {
    margin-top: 0.125rem;
}
.form-check-label {
    font-size: 11px;
    margin-left: 0.25rem;
}
.form-text {
    font-size: 10px;
    margin-top: 2px;
    color: #6c757d;
}

/* Dark mode styles */
[data-bs-theme="dark"] .form-section {
    background-color: #2d2d2d !important;
    border-color: #404040 !important;
    color: #e0e0e0 !important;
}

[data-bs-theme="dark"] .form-section h4 {
    color: #ffffff !important;
    border-bottom-color: #404040 !important;
}

[data-bs-theme="dark"] .form-section:hover {
    background-color: #363636 !important;
}

[data-bs-theme="dark"] .form-label {
    color: #ffffff !important;
}

[data-bs-theme="dark"] .form-text {
    color: #b0b0b0 !important;
}

[data-bs-theme="dark"] .required-field {
    color: #ff6b6b !important;
}

[data-bs-theme="dark"] .submit-buttons {
    border-top-color: #404040 !important;
}

/* Dark mode button overrides */
[data-bs-theme="dark"] .btn-primary {
    background-color: #6b7280 !important;
    border-color: #6b7280 !important;
    color: white !important;
}

[data-bs-theme="dark"] .btn-primary:hover {
    background-color: #4b5563 !important;
    border-color: #4b5563 !important;
    color: white !important;
}

[data-bs-theme="dark"] .btn-outline-secondary {
    background-color: transparent !important;
    border-color: #6b7280 !important;
    color: #6b7280 !important;
}

[data-bs-theme="dark"] .btn-outline-secondary:hover {
    background-color: #6b7280 !important;
    border-color: #6b7280 !important;
    color: white !important;
}
</style>
{% endblock %}

{% block content %}


<div class="px-3">

    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center my-3">
        <div>
            <h2 style="font-size: 18px; font-weight: 600; margin: 0;">{{ title }}</h2>
           
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <form method="post" novalidate>
                {% csrf_token %}
                
                <!-- Basic Information -->
                <div class="border bg-white rounded-lg">
                    <div class="py-2 bg-gray-100 px-3 rounded-t-lg">
                        <h4>Basic Information</h4>
                    </div>
                    
                    <div class="row g-3 p-3">
                        <div class="col-6">
                            <label for="{{ form.name.id_for_label }}" class="form-label">
                                Building Name <span class="required-field">*</span>
                            </label>
                            {{ form.name }}
                            {% if form.name.errors %}
                                <div class="text-danger" style="font-size: 10px;">
                                    {% for error in form.name.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Enter a unique name for the building</div>
                        </div>
                        <div class="col-6">
                            <label for="{{ form.code.id_for_label }}" class="form-label">
                                Building Code <span class="required-field">*</span>
                            </label>
                            {{ form.code }}
                            {% if form.code.errors %}
                                <div class="text-danger" style="font-size: 10px;">
                                    {% for error in form.code.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Enter a unique code for the building</div>
                        </div>
                    </div>
                    <div class="row g-3 px-3 pb-3">
                        <div class="col-6">
                            <label for="{{ form.zone.id_for_label }}" class="form-label">
                                Zone
                            </label>
                            {{ form.zone }}
                            {% if form.zone.errors %}
                                <div class="text-danger" style="font-size: 10px;">
                                    {% for error in form.zone.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Select the zone this building belongs to</div>
                        </div>
                        <div class="col-6">
                            <div class="mb-3">
                                <label class="form-label mb-2">Floor Configuration</label>
                                <div class="form-check form-switch">
                                    {{ form.no_floor }}
                                    <label for="{{ form.no_floor.id_for_label }}" class="form-check-label">
                                        <span id="no-floor-label">Building has specific floors</span>
                                    </label>
                                </div>
                                {% if form.no_floor.errors %}
                                    <div class="text-danger" style="font-size: 10px;">
                                        {% for error in form.no_floor.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">Toggle to indicate if this building has specific floor divisions</div>
                            </div>
                            
                            <div id="total-floors-section">
                                <label for="{{ form.total_floors.id_for_label }}" class="form-label">
                                    Total Floors <span class="required-field">*</span>
                                </label>
                                {{ form.total_floors }}
                                {% if form.total_floors.errors %}
                                    <div class="text-danger" style="font-size: 10px;">
                                        {% for error in form.total_floors.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">Number of floors in the building</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Address Information -->
                <div class="border bg-white rounded-lg mt-3">
                    <div class="py-2 bg-gray-100 px-3 rounded-t-lg">
                        <h4>Address Information</h4>
                    </div>
                   
                    <div class="row g-1 p-3">
                        <div class="col-12">
                            <label for="{{ form.address.id_for_label }}" class="form-label">
                                Address <span class="required-field">*</span>
                            </label>
                            {{ form.address }}
                            {% if form.address.errors %}
                                <div class="text-danger" style="font-size: 10px;">
                                    {% for error in form.address.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Complete address of the building</div>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="border bg-white rounded-lg mt-3">
                    <div class="py-2 bg-gray-100 px-3 rounded-t-lg">
                        <h4>Additional Information</h4>
                    </div>
                    
                    <div class="row g-1 p-3">
                        <div class="col-12">
                            <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
                            {{ form.description }}
                            {% if form.description.errors %}
                                <div class="text-danger" style="font-size: 10px;">
                                    {% for error in form.description.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Optional description or notes about the building</div>
                        </div>
                    </div>
                    <div class="row g-1 mt-1 p-3">
                        <div class="col-12">
                            <div class="form-check">
                                {{ form.is_active }}
                                <label for="{{ form.is_active.id_for_label }}" class="form-check-label">
                                    Active Building
                                </label>
                            </div>
                            {% if form.is_active.errors %}
                                <div class="text-danger" style="font-size: 10px;">
                                    {% for error in form.is_active.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Uncheck to deactivate this building</div>
                        </div>
                    </div>
                </div>

                <!-- Submit Buttons -->
                <div class="flex justify-end space-x-3 my-4">
                    <a href="{% if building %}{% url 'zone:building_detail' building.id %}{% else %}{% url 'zone:building_list' %}{% endif %}" class="button-min-danger">Cancel</a>
                    <button type="submit" class="button-min-primary">{{ submit_text }}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-resize textarea
    const textareas = document.querySelectorAll('textarea');
    textareas.forEach(textarea => {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
        
        // Initial resize
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    });

    // No Floor toggle functionality
    const noFloorToggle = document.getElementById('{{ form.no_floor.id_for_label }}');
    const noFloorLabel = document.getElementById('no-floor-label');
    const totalFloorsSection = document.getElementById('total-floors-section');
    const totalFloorsInput = document.getElementById('{{ form.total_floors.id_for_label }}');

    function updateFloorToggle() {
        if (noFloorToggle.checked) {
            // When "no floor" is enabled (no_floor = true, building has NO floors)
            noFloorLabel.textContent = 'Building has no specific floors';
            noFloorLabel.style.color = '#dc3545'; // Red color
            totalFloorsSection.style.display = 'none'; // Hide the total floors section completely
            totalFloorsInput.value = '0'; // Set to 0 when no floors
        } else {
            // When "no floor" is disabled (no_floor = false, building HAS floors)
            noFloorLabel.textContent = 'Building has specific floors';
            noFloorLabel.style.color = '#198754'; // Green color
            totalFloorsSection.style.display = 'block'; // Show the total floors section
            totalFloorsInput.disabled = false;
            if (totalFloorsInput.value === '0') {
                totalFloorsInput.value = ''; // Clear the value if it was set to 0
            }
        }
    }

    // Initialize toggle state
    updateFloorToggle();

    // Add event listener for toggle changes
    noFloorToggle.addEventListener('change', updateFloorToggle);
});
</script>
{% endblock %} 