{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ title }} - Zone Management{% endblock %}

{% block main_class %}col-md-10 ms-sm-auto col-lg-10{% endblock %}

{% block extra_css %}
<style>
.form-section {
    border: 1px solid #dee2e6;
    padding: 8px;
    margin-bottom: 8px;
    background-color: #f8f9fa;
    border-radius: 3px;
}
.form-section h4 {
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 6px;
    color: #495057;
    text-transform: uppercase;
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 3px;
}
.required-field {
    color: #dc3545;
}
.form-label {
    font-size: 11px !important;
    margin-bottom: 2px !important;
    font-weight: 500;
}
.form-control, .form-select {
    font-size: 12px !important;
    padding: 6px 8px !important;
    height: auto !important;
    border-radius: 5px;
    border:1px solid #dee2e6;
}
.row.g-1 {
    --bs-gutter-x: 0.25rem;
    --bs-gutter-y: 0.25rem;
}
.btn {
    font-size: 12px;
    padding: 6px 12px;
}
.btn-sm {
    font-size: 11px;
    padding: 4px 8px;
}
/* Compact submit button area */
.submit-buttons {
    margin-top: 16px;
    padding-top: 12px;
    border-top: 1px solid #dee2e6;
}
/* Form section hover effect */
.form-section:hover {
    background-color: #f1f3f4;
}
/* Textarea styling */
textarea.form-control {
    resize: vertical;
    min-height: 60px;
}
.form-check-input {
    margin-top: 0.125rem;
}
.form-check-label {
    font-size: 11px;
    margin-left: 0.25rem;
}
.form-text {
    font-size: 10px;
    margin-top: 2px;
    color: #6c757d;
}
.building-info {
    background: #e3f2fd;
    border: 1px solid #bbdefb;
    border-radius: 3px;
    padding: 6px;
    margin-top: 4px;
    font-size: 10px;
}
.building-info h6 {
    color: #1976d2;
    margin-bottom: 2px;
    font-size: 10px;
    font-weight: 600;
}
.building-info p {
    margin: 0;
    color: #424242;
    font-size: 10px;
}

/* Dark mode styles */
[data-bs-theme="dark"] .form-section {
    background-color: #2d2d2d !important;
    border-color: #404040 !important;
    color: #e0e0e0 !important;
}

[data-bs-theme="dark"] .form-section h4 {
    color: #ffffff !important;
    border-bottom-color: #404040 !important;
}

[data-bs-theme="dark"] .form-section:hover {
    background-color: #363636 !important;
}

[data-bs-theme="dark"] .form-label {
    color: #ffffff !important;
}

[data-bs-theme="dark"] .form-text {
    color: #b0b0b0 !important;
}

[data-bs-theme="dark"] .required-field {
    color: #ff6b6b !important;
}

[data-bs-theme="dark"] .submit-buttons {
    border-top-color: #404040 !important;
}

[data-bs-theme="dark"] .building-info {
    background-color: #2d4a5c !important;
    border-color: #3b82f6 !important;
    color: #e0e0e0 !important;
}

[data-bs-theme="dark"] .building-info h6 {
    color: #60a5fa !important;
}

[data-bs-theme="dark"] .building-info p {
    color: #b0b0b0 !important;
}

/* Dark mode button overrides */
[data-bs-theme="dark"] .btn-primary {
    background-color: #6b7280 !important;
    border-color: #6b7280 !important;
    color: white !important;
}

[data-bs-theme="dark"] .btn-primary:hover {
    background-color: #4b5563 !important;
    border-color: #4b5563 !important;
    color: white !important;
}

[data-bs-theme="dark"] .btn-outline-secondary {
    background-color: transparent !important;
    border-color: #6b7280 !important;
    color: #6b7280 !important;
}

[data-bs-theme="dark"] .btn-outline-secondary:hover {
    background-color: #6b7280 !important;
    border-color: #6b7280 !important;
    color: white !important;
}

/* Dark mode form sections */
[data-bs-theme="dark"] .form-section {
    background-color: #2d2d2d !important;
    border-color: #404040 !important;
}

[data-bs-theme="dark"] .form-section h4 {
    color: #ffffff !important;
    border-bottom-color: #404040 !important;
}

[data-bs-theme="dark"] .required-field {
    color: #ff6b6b !important;
}

[data-bs-theme="dark"] .building-info {
    background: #1565c0 !important;
    border-color: #1976d2 !important;
}

[data-bs-theme="dark"] .building-info h6 {
    color: #ffffff !important;
}

[data-bs-theme="dark"] .building-info p {
    color: #e3f2fd !important;
}
</style>
{% endblock %}

{% block content %}

 <div class="px-3">
    <!-- Page Header -->
 <div class="d-flex justify-content-between align-items-center my-3">
    <div>
        <h2 style="font-size: 18px; font-weight: 600; margin: 0;">{{ title }}</h2>
       
    </div>
</div>

<div class="row">
    <div class="col-12">
        <form method="post" novalidate>
            {% csrf_token %}
            
            <!-- Building Assignment -->
            <div class="border bg-white rounded-lg">
                <div class="py-2 bg-gray-100 px-3 rounded-t-lg">
                    <h4>Building Assignment</h4>
                </div>
                
                <div class="row g-1 p-3">
                    <div class="col-12">
                        <label for="{{ form.building.id_for_label }}" class="form-label">
                            Building <span class="required-field">*</span>
                        </label>
                        {{ form.building }}
                        {% if form.building.errors %}
                            <div class="text-danger" style="font-size: 10px;">
                                {% for error in form.building.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">Select the building this floor belongs to</div>
                        
                        <!-- Building Info Display -->
                        <div id="building-info" class="building-info" style="display: none;">
                            <h6>Building Information</h6>
                            <p id="building-address"></p>
                            <p id="building-floors"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Floor Details -->
            <div class="border bg-white rounded-lg mt-3">
                <div class="py-2 bg-gray-100 px-3 rounded-t-lg">
                    <h4>Floor Details</h4>
                </div>
                
                <div class="row g-3 p-3">
                    <div class="col-6">
                        <label for="{{ form.floor_number.id_for_label }}" class="form-label">
                            Floor Number <span class="required-field">*</span>
                        </label>
                        {{ form.floor_number }}
                        {% if form.floor_number.errors %}
                            <div class="text-danger" style="font-size: 10px;">
                                {% for error in form.floor_number.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">Numeric floor number (e.g., 1, 2, 3...)</div>
                    </div>
                    <div class="col-6">
                        <label for="{{ form.name.id_for_label }}" class="form-label">
                            Floor Name <span class="required-field">*</span>
                        </label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div class="text-danger" style="font-size: 10px;">
                                {% for error in form.name.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">Descriptive name for the floor</div>
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="border bg-white rounded-lg mt-3">
                <div class="py-2 bg-gray-100 px-3 rounded-t-lg">
                    <h4>Additional Information</h4>
                </div>
                
                <div class="row g-1 p-3">
                    <div class="col-12">
                        <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <div class="text-danger" style="font-size: 10px;">
                                {% for error in form.description.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">Optional description or notes about the floor</div>
                    </div>
                </div>
                <div class="row g-1 mt-1 px-3 pb-3">
                    <div class="col-12">
                        <div class="form-check">
                            {{ form.is_active }}
                            <label for="{{ form.is_active.id_for_label }}" class="form-check-label">
                                Active Floor
                            </label>
                        </div>
                            <div class="text-danger" style="font-size: 10px;">
                                {% for error in form.is_active.errors %}{{ error }}{% endfor %}
                            </div>
                        <div class="form-text">Uncheck to deactivate this floor</div>
                    </div>
                </div>
            </div>

            <!-- Submit Buttons -->
            <div class="flex items-center justify-end space-x-3 my-4">
                <a href="{% if floor %}{% url 'zone:floor_detail' floor.id %}{% else %}{% url 'zone:floor_list' %}{% endif %}" class="button-min-danger">Cancel</a>
                <button type="submit" class="button-min-primary">{{ submit_text }}</button>
            </div>
        </form>
    </div>
</div>

 </div>

{{ buildings_data|json_script:"building-data" }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Building data for info display
    const buildingDataElement = document.getElementById('building-data');
    const buildingList = buildingDataElement ? JSON.parse(buildingDataElement.textContent) : [];
    const buildingData = {};
    
    // Convert list to object for easier lookup
    buildingList.forEach(building => {
        buildingData[building.id] = building;
    });
    
    const buildingSelect = document.getElementById('{{ form.building.id_for_label }}');
    const buildingInfo = document.getElementById('building-info');
    const buildingAddress = document.getElementById('building-address');
    const buildingFloors = document.getElementById('building-floors');
    
    function updateBuildingInfo() {
        const selectedBuildingId = buildingSelect.value;
        if (selectedBuildingId && buildingData[selectedBuildingId]) {
            const building = buildingData[selectedBuildingId];
            buildingAddress.textContent = `Address: ${building.address || 'N/A'}`;
            buildingFloors.textContent = `Total Floors: ${building.total_floors || 'N/A'}`;
            buildingInfo.style.display = 'block';
        } else {
            buildingInfo.style.display = 'none';
        }
    }
    
    // Update building info on change
    buildingSelect.addEventListener('change', updateBuildingInfo);
    
    // Initial update
    updateBuildingInfo();
    
    // Auto-resize textarea
    const textareas = document.querySelectorAll('textarea');
    textareas.forEach(textarea => {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
        
        // Initial resize
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    });
    
    // Auto-generate floor name based on floor number
    const floorNumberInput = document.getElementById('{{ form.floor_number.id_for_label }}');
    const floorNameInput = document.getElementById('{{ form.name.id_for_label }}');
    
    floorNumberInput.addEventListener('input', function() {
        const floorNumber = parseInt(this.value);
        if (floorNumber && !floorNameInput.value) {
            let floorName = '';
            if (floorNumber === 0) {
                floorName = 'Ground Floor';
            } else if (floorNumber === 1) {
                floorName = 'First Floor';
            } else if (floorNumber === 2) {
                floorName = 'Second Floor';
            } else if (floorNumber === 3) {
                floorName = 'Third Floor';
            } else {
                floorName = `Floor ${floorNumber}`;
            }
            floorNameInput.value = floorName;
        }
    });
});
</script>
{% endblock %} 