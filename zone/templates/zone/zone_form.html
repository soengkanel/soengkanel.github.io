{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ title }} - Zone Management{% endblock %}

{% block main_class %}col-md-10 ms-sm-auto col-lg-10{% endblock %}

{% block extra_css %}
<style>
.form-section {
    border: 1px solid #dee2e6;
    padding: 8px;
    margin-bottom: 8px;
    background-color: #f8f9fa;
    border-radius: 3px;
}
.form-section h4 {
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 6px;
    color: #495057;
    text-transform: uppercase;
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 3px;
}
.required-field {
    color: #dc3545;
}
.form-label {
    font-size: 11px !important;
    margin-bottom: 2px !important;
    font-weight: 500;
}
.form-control, .form-select {
    font-size: 12px !important;
    padding: 6px 8px !important;
    height: auto !important;
    border-radius: 5px;
    border:1px solid #dee2e6;
}
.row.g-1 {
    --bs-gutter-x: 0.25rem;
    --bs-gutter-y: 0.25rem;
}
.btn {
    font-size: 12px;
    padding: 6px 12px;
}
.btn-sm {
    font-size: 11px;
    padding: 4px 8px;
}
/* Compact submit button area */
.submit-buttons {
    margin-top: 16px;
    padding-top: 12px;
    border-top: 1px solid #dee2e6;
}
/* Form section hover effect */
.form-section:hover {
    background-color: #f1f3f4;
}
/* Textarea styling */
textarea.form-control {
    resize: vertical;
    min-height: 60px;
}
.form-check-input {
    margin-top: 0.125rem;
}
.form-check-label {
    font-size: 11px;
    margin-left: 0.25rem;
}
.form-text {
    font-size: 10px;
    margin-top: 2px;
    color: #6c757d;
}

/* Dark mode styles */
[data-bs-theme="dark"] .form-section {
    background-color: #2d3748;
    border-color: #4a5568;
}

[data-bs-theme="dark"] .form-section h4 {
    color: #e2e8f0;
    border-bottom-color: #4a5568;
}

[data-bs-theme="dark"] .form-control,
[data-bs-theme="dark"] .form-select {
    background-color: #4a5568;
    border-color: #718096;
    color: #e2e8f0;
}

[data-bs-theme="dark"] .form-control:focus,
[data-bs-theme="dark"] .form-select:focus {
    background-color: #4a5568;
    border-color: #63b3ed;
    color: #e2e8f0;
    box-shadow: 0 0 0 0.2rem rgba(99, 179, 237, 0.25);
}

[data-bs-theme="dark"] .form-label {
    color: #e2e8f0;
}

[data-bs-theme="dark"] .form-text {
    color: #a0aec0;
}

[data-bs-theme="dark"] .required-field {
    color: #fc8181;
}

[data-bs-theme="dark"] .btn-primary {
    background-color: #4299e1 !important;
    border-color: #4299e1 !important;
}

[data-bs-theme="dark"] .btn-primary:hover {
    background-color: #3182ce !important;
    border-color: #3182ce !important;
}

[data-bs-theme="dark"] .btn-outline-secondary {
    color: #a0aec0 !important;
    border-color: #a0aec0 !important;
}

[data-bs-theme="dark"] .btn-outline-secondary:hover {
    background-color: #6b7280 !important;
    border-color: #6b7280 !important;
    color: white !important;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-3 py-3">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2 style="font-size: 18px; font-weight: 600; margin: 0;">{{ title }}</h2>
            <p style="font-size: 11px; color: #666; margin: 0;">Create or edit zone information</p>
        </div>
    </div>

    <!-- Form -->
    <div class="row pt-2">
        <div class="col-12">
            <form method="post" novalidate>
                {% csrf_token %}
                
                <!-- Zone Information -->
                <div class="border bg-white rounded-lg">
                  <div class="py-2 bg-gray-100 px-3 rounded-t-lg">
                    <h4>Zone Information</h4>
                  </div>
                    <div class="row g-1 p-3">
                        <div class="col-12">
                            <label for="{{ form.name.id_for_label }}" class="form-label">
                                Zone Name <span class="required-field">*</span>
                            </label>
                            {{ form.name }}
                            {% if form.name.errors %}
                                <div class="text-danger" style="font-size: 10px;">
                                    {% for error in form.name.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">{{ form.name.help_text }}</div>
                        </div>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="border bg-white rounded-lg mt-3">
                    <div class="py-2 bg-gray-100 px-3 rounded-t-lg">
                        <h4>Contact Information</h4>
                    </div>
                    
                    <div class="row g-1 p-3">
                        <div class="col-6">
                            <label for="{{ form.phone_number.id_for_label }}" class="form-label">
                                Phone Number
                            </label>
                            {{ form.phone_number }}
                            {% if form.phone_number.errors %}
                                <div class="text-danger" style="font-size: 10px;">
                                    {% for error in form.phone_number.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text" id="zone_phone_helper">Zone's contact phone number</div>
                        </div>
                        <div class="col-6">
                            <!-- Spacer -->
                        </div>
                    </div>
                    <div class="row g-1 mt-1 px-3 pb-2">
                        <div class="col-12">
                            <label for="{{ form.address.id_for_label }}" class="form-label">
                                Address
                            </label>
                            {{ form.address }}
                            {% if form.address.errors %}
                                <div class="text-danger" style="font-size: 10px;">
                                    {% for error in form.address.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Zone's address or location description</div>
                        </div>
                    </div>
                </div>

                <!-- Zone Status -->
                <div class="border bg-white rounded-lg mt-3">
                    <div class="py-2 bg-gray-100 px-3 rounded-t-lg">
                        <h4>Zone Status</h4>
                    </div>
                   
                    <div class="row g-1 p-3">
                        <div class="col-12">
                            <div class="form-check">
                                {{ form.is_active }}
                                <label for="{{ form.is_active.id_for_label }}" class="form-check-label">
                                    Active Zone
                                </label>
                            </div>
                            {% if form.is_active.errors %}
                                <div class="text-danger" style="font-size: 10px;">
                                    {% for error in form.is_active.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Uncheck to create inactive zone</div>
                        </div>
                    </div>
                </div>

                <!-- Display Form Errors -->
                {% if form.non_field_errors %}
                    <div class="alert alert-danger" style="font-size: 11px; padding: 6px 12px;">
                        {% for error in form.non_field_errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}

                <!-- Submit Buttons -->
                <div class="flex justify-end space-x-3 items-center my-4">
                    <a href="{% url 'zone:zone_list' %}" class="button-min-danger">Cancel</a>
                    <button type="submit" class="button-min-primary" id="btn_save">{{ submit_text }}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-resize textarea
    const textareas = document.querySelectorAll('textarea');
    textareas.forEach(textarea => {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
        
        // Initial resize
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    });

    // Zone name validation
    const nameField = document.getElementById('{{ form.name.id_for_label }}');
    if (nameField) {
        nameField.addEventListener('input', function() {
            const value = this.value.trim();
            if (value.length > 0 && value.length < 2) {
                this.setCustomValidity('Zone name must be at least 2 characters long');
            } else {
                this.setCustomValidity('');
            }
        });
    }
    var btn_save = document.getElementById("btn_save")
    var id_phone_number = document.getElementById("id_phone_number");
    var zone_phone_helper = document.getElementById("zone_phone_helper");
    var zone_phone_helper_text_original = zone_phone_helper.textContent;
        if (id_phone_number){

            id_phone_number.addEventListener('input', function(e){
                if(e.target.value.length > 0){
                    
                    if(e.target.value.length > 15){
                        btn_save.setAttribute('disabled', '');
                        this.style ="border:1px solid #dc3545 !important;"
                        zone_phone_helper.style = "color:#dc3545"
                        zone_phone_helper.textContent = "Zone phone number must be less then 16 characters long"
                    }else{
                        btn_save.removeAttribute('disabled');
                        zone_phone_helper.textContent = zone_phone_helper_text_original
                        this.style ="border:none;"
                        zone_phone_helper.style = "color:gray"
                    }
                }else{
                    btn_save.removeAttribute('disabled');
                }
                
            });

        }
});
</script>
{% endblock %} 