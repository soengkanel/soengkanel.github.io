<div class=" rounded-lg border border-gray-200 mt-4">
    <div class="border-b border-gray-200 py-2 px-3 bg-gray-50 rounded-t-lg">
        <h4 class="text-[16px] font-semibold"><i class="fa fa-file-image me-2"></i>Documents ({{ documents.count }})</h4>
    </div>

    <div class="py-3">
        {% if documents %}
            {% for document in documents %}
                <div class="document-form border mx-3 rounded my-3">
                    <div class="flex justify-between items-center px-3 bg-gray-100 py-2 border-b">
                        <h5 class="font-medium text-blue-500 flex items-center space-x-2 mb-0 pb-0">
                            Document #{{ forloop.counter }} - {{ document.get_document_type_display|default:"Unknown Type" }}
                        </h5>
                        <div class="flex items-center space-x-2">
                            {% if document.expiry_date %}
                                {% if document.is_expired %}
                                    <span class="bg-red-100 text-red-800 text-xs font-medium px-2 py-1 rounded-full">Expired</span>
                                {% else %}
                                    <span class="bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full">Valid</span>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 px-3 py-1 mb-2 mt-3">
                        <div class="border rounded col-span-1">
                            <div class="border-b border-gray-200 px-3 py-2 bg-gray-50">
                                <h4 class="text-[16px] font-semibold"><i class="bi bi-image me-2"></i>Document Preview</h4>
                            </div>
                            <div class="px-3 py-3">
                                <div class="relative image-preview-card px-2 py-3 border rounded bg-gray-100 flex flex-col items-center justify-center" style="border:2px dotted #999 !important; min-height:200px; position:relative;">
                                    
                                    <!-- Match exact logic from edit form -->
                                    {% if document.pk and document.document_file.name %}
                                        <!-- Document has file - show image -->
                                        <div class="relative doc-img-preview">
                                            {% if document.document_file.name|default:""|slice:"-4:"|lower == ".pdf" %}
                                                <div class="text-center p-4">
                                                    <i class="bi bi-file-earmark-pdf text-danger" style="font-size: 4rem;"></i>
                                                    <div class="mt-2">
                                                        <small class="text-muted d-block">PDF Document</small>
                                                        <small class="text-muted">{{ document.document_file.name|default:"Unknown"|slice:"17:" }}</small>
                                                    </div>
                                                    <div class="mt-3">
                                                        <a href="{% url 'zone:serve_encrypted_image' document.id %}" target="_blank" class="btn btn-sm btn-outline-primary me-2">
                                                            <i class="bi bi-eye me-1"></i>View PDF
                                                        </a>
                                                        <a href="{% url 'zone:serve_encrypted_image' document.id %}" download class="btn btn-sm btn-outline-secondary">
                                                            <i class="bi bi-download me-1"></i>Download
                                                        </a>
                                                    </div>
                                                </div>
                                            {% else %}
                                                <img src="{% url 'zone:serve_encrypted_image' document.pk %}" 
                                                     alt="document" 
                                                     id="document-image-{{ forloop.counter0 }}" 
                                                     class="document-image rounded"
                                                     style="max-height: 180px; width: auto;"
                                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                <div id="document-image-icon-{{ forloop.counter0 }}" class="document-image-icon flex flex-col items-center justify-center" style="display: none;">
                                                    <i class="bi bi-exclamation-triangle text-warning" style="font-size:46px;"></i>
                                                    <span class="text-xs text-warning text-center">Image failed to load</span>
                                                </div>
                                                <div class="mt-2 text-center">
                                                    <small class="text-muted d-block">{{ document.document_file.name|default:"Unknown file"|slice:"17:" }}</small>
                                                    <div class="mt-2">
                                                        <a href="{% url 'zone:serve_encrypted_image' document.id %}" download class="btn btn-sm btn-outline-secondary">
                                                            <i class="bi bi-download me-1"></i>Download
                                                        </a>
                                                    </div>
                                                </div>
                                            {% endif %}
                                        </div>
                                    {% elif document.pk %}
                                        <!-- Document record exists but no file -->
                                        <div id="document-image-icon-{{ forloop.counter0 }}" class="document-image-icon flex flex-col items-center justify-center">
                                            <i class="bi bi-image text-muted" style="font-size:46px;"></i>
                                            <span class="text-xs text-muted text-center">Document record exists</span>
                                            <span class="text-xs text-muted text-center">No file uploaded</span>
                                        </div>
                                    {% else %}
                                        <!-- No document -->
                                        <div id="document-image-icon-{{ forloop.counter0 }}" class="document-image-icon flex flex-col items-center justify-center">
                                            <i class="bi bi-image text-gray-500" style="font-size:46px;"></i>
                                            <span class="text-xs text-gray-500 text-center">No document uploaded</span>
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <!-- File status indicator to match edit form -->
                                {% if document.pk and document.document_file %}
                                    <div class="text-success text-xs mt-2 text-center">
                                        <i class="bi bi-check-circle"></i> File exists: {{ document.document_file.name|slice:"17:" }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="border rounded col-span-2">
                            <div class="border-b border-gray-200 px-3 py-2 bg-gray-50">
                                <h4 class="text-[16px] font-semibold"><i class="bi bi-info-circle me-2"></i>Document Information</h4>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 px-3 py-2">
                                <div class="flex flex-col gap-1">
                                    <label class="text-xs font-medium text-gray-600">Document Type</label>
                                    <div class="p-2 rounded border border-gray-200 bg-gray-50 text-sm">{{ document.get_document_type_display }}</div>
                                </div>

                                <div class="flex flex-col gap-1">
                                    <label class="text-xs font-medium text-gray-600">Document Number</label>
                                    <div class="p-2 rounded border border-gray-200 bg-gray-50 text-sm font-mono">{{ document.document_number|default:"-" }}</div>
                                </div>

                                <div class="flex flex-col gap-1">
                                    <label class="text-xs font-medium text-gray-600">Issue Date</label>
                                    <div class="p-2 rounded border border-gray-200 bg-gray-50 text-sm">{{ document.issue_date|date:"F d, Y"|default:"-" }}</div>
                                </div>

                                <div class="flex flex-col gap-1">
                                    <label class="text-xs font-medium text-gray-600">Expiry Date</label>
                                    <div class="p-2 rounded border border-gray-200 bg-gray-50 text-sm">
                                        {{ document.expiry_date|date:"F d, Y"|default:"-" }}
                                        {% if document.expiry_date and document.is_expired %}
                                            <span class="text-red-600 text-xs ml-2">(Expired)</span>
                                        {% endif %}
                                    </div>
                                </div>

                                {% if document.issuing_authority %}
                                <div class="col-span-2 flex flex-col gap-1">
                                    <label class="text-xs font-medium text-gray-600">Issuing Authority</label>
                                    <div class="p-2 rounded border border-gray-200 bg-gray-50 text-sm">{{ document.issuing_authority }}</div>
                                </div>
                                {% endif %}

                                {% if document.notes %}
                                <div class="col-span-2 flex flex-col gap-1">
                                    <label class="text-xs font-medium text-gray-600">Notes</label>
                                    <div class="p-2 rounded border border-gray-200 bg-gray-50 text-sm" style="min-height: 40px;">{{ document.notes }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="text-center p-4">
                <div class="text-gray-400">
                    <i class="fa fa-file-image text-4xl mb-2"></i>
                    <p class="text-sm">No documents found for this worker.</p>
                </div>
            </div>
        {% endif %}
    </div>
</div>