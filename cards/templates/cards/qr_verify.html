{% extends 'base/base.html' %}
{% load static %}

{% block title %}Card Verification{% endblock %}

{% block extra_css %}
<style>
    .verify-container {
        max-width: 600px;
        margin: 2rem auto;
        padding: 2rem;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .verify-success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 4px;
        padding: 1rem;
        margin-bottom: 1rem;
        color: #155724;
    }
    
    .verify-error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 4px;
        padding: 1rem;
        margin-bottom: 1rem;
        color: #721c24;
    }
    
    .card-info {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 1rem;
        margin: 1rem 0;
    }
    
    .info-row {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid #eee;
    }
    
    .info-row:last-child {
        border-bottom: none;
    }
    
    .info-label {
        font-weight: 600;
        color: #495057;
    }
    
    .info-value {
        color: #212529;
    }
    
    .status-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .status-active {
        background: #d4edda;
        color: #155724;
    }
    
    .status-pending {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-expired {
        background: #f8d7da;
        color: #721c24;
    }
</style>
{% endblock %}

{% block content %}
<div class="verify-container">
    <h1><i class="fas fa-qrcode"></i> Card Verification</h1>
    <p class="text-muted">This page demonstrates what happens when a QR code from a worker ID card is scanned.</p>
    
    <div id="verification-result">
        <!-- This would be populated by JavaScript when QR code is scanned -->
        <div class="verify-success">
            <h4><i class="fas fa-check-circle"></i> Card Verified Successfully</h4>
            <p>The QR code contains valid worker card information.</p>
        </div>
        
        <div class="card-info">
            <h5>Worker Information</h5>
            <div class="info-row">
                <span class="info-label">Name:</span>
                <span class="info-value">John Doe</span>
            </div>
            <div class="info-row">
                <span class="info-label">Worker ID:</span>
                <span class="info-value">W001234</span>
            </div>
            <div class="info-row">
                <span class="info-label">Card Number:</span>
                <span class="info-value">EMP-00123</span>
            </div>
            <div class="info-row">
                <span class="info-label">Position:</span>
                <span class="info-value">Software Developer</span>
            </div>
            <div class="info-row">
                <span class="info-label">Gender:</span>
                <span class="info-value">Male</span>
            </div>
            <div class="info-row">
                <span class="info-label">Date of Birth:</span>
                <span class="info-value">1990-05-15</span>
            </div>
            <div class="info-row">
                <span class="info-label">Building:</span>
                <span class="info-value">Main Office</span>
            </div>
            <div class="info-row">
                <span class="info-label">Floor:</span>
                <span class="info-value">3rd Floor</span>
            </div>
            <div class="info-row">
                <span class="info-label">Status:</span>
                <span class="info-value"><span class="status-badge status-active">Active</span></span>
            </div>
            <div class="info-row">
                <span class="info-label">Issue Date:</span>
                <span class="info-value">2024-01-15</span>
            </div>
            <div class="info-row">
                <span class="info-label">Expiry Date:</span>
                <span class="info-value">2025-01-15</span>
            </div>
            <div class="info-row">
                <span class="info-label">Verified At:</span>
                <span class="info-value">{{ "now"|date:"Y-m-d H:i:s" }}</span>
            </div>
        </div>
    </div>
    
    <div class="mt-3">
        <h5>QR Code Contains:</h5>
        <pre style="background: #f8f9fa; padding: 1rem; border-radius: 4px; font-size: 0.875rem;">
{
  "type": "worker_id_card",
  "card_id": 123,
  "worker_id": "W001234",
  "worker_name": "John Doe",
  "card_number": "EMP-00123",
  "building": "Main Office",
  "floor": "3rd Floor",
  "position": "Software Developer",
  "gender": "Male",
  "date_of_birth": "1990-05-15",
  "status": "active",
  "issue_date": "2024-01-15T00:00:00",
  "expiry_date": "2025-01-15T00:00:00"
}
        </pre>
    </div>
    
    <div class="mt-3">

    </div>
</div>

<script>
// This would be the JavaScript that handles actual QR code scanning
function verifyCard(cardData) {
    // Parse QR code data and display card information
    console.log('Card data:', cardData);
    
    // Make API call to verify card
    fetch(`/cards/api/worker-card/${cardData.card_id}/verify/`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                displayCardInfo(data.card);
            } else {
                displayError(data.error);
            }
        })
        .catch(error => {
            displayError('Failed to verify card');
        });
}

function displayCardInfo(card) {
    // Update the page with actual card data
    console.log('Verified card:', card);
}

function displayError(error) {
    // Show error message
    console.error('Verification error:', error);
}
</script>
{% endblock %} 