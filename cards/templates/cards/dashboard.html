{% extends 'base/base.html' %}
{% load static %}

{% block title %}ID Cards Management{% endblock %}

{% block extra_css %}
{% include 'includes/compact_ui.html' %}
<style>
/* ID Cards specific compact styles */
.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--space-6);
}

/* Stats Grid */
.stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: var(--space-4);
    margin-bottom: var(--space-8);
}

.stat-card {
    background: var(--white);
    border: var(--border);
    border-left: var(--border-thick);
    border-radius: var(--radius);
    padding: var(--space-5);
    text-align: center;
}

.stat-value {
    font-size: var(--text-3xl);
    font-weight: 700;
    color: var(--black);
    margin-bottom: var(--space-1);
    line-height: 1;
}

.stat-label {
    font-size: var(--text-sm);
    color: var(--gray-500);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat-trend {
    font-size: var(--text-xs);
    font-weight: 500;
    margin-top: var(--space-2);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-1);
}

.trend-up { color: var(--success); }
.trend-down { color: var(--danger); }
.trend-neutral { color: var(--gray-400); }

/* Quick Actions Grid */
.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-6);
    margin-bottom: var(--space-8);
}

.action-card {
    background: var(--white);
    border: var(--border);
    border-radius: var(--radius);
    padding: var(--space-6);
    text-decoration: none;
    color: inherit;
    position: relative;
}

.action-card:hover {
    text-decoration: none;
    color: inherit;
}

.featured-card {
    border: 2px solid var(--primary);
    background: linear-gradient(135deg, var(--primary-light) 0%, #e0f2fe 100%);
}

.featured-card::after {
    content: 'MAIN';
    position: absolute;
    top: var(--space-2);
    right: var(--space-2);
    background: var(--primary);
    color: var(--black);
    font-size: var(--text-xs);
    font-weight: 600;
    padding: var(--space-1) var(--space-2);
    border-radius: 10px;
    letter-spacing: 0.5px;
}

.action-header {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    margin-bottom: var(--space-3);
}

.action-icon {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-lg);
    color: var(--white);
    flex-shrink: 0;
}

.action-title {
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--black);
    margin: 0;
    line-height: 1.3;
}

.action-desc {
    font-size: var(--text-sm);
    color: var(--gray-600);
    margin: 0 0 var(--space-3) 0;
    line-height: 1.4;
}

.action-meta {
    font-size: var(--text-xs);
    color: var(--gray-500);
    display: flex;
    align-items: center;
    gap: var(--space-1);
}

/* Activity Sections */
.activity-section {
    background: var(--white);
    border: var(--border);
    border-radius: var(--radius);
    margin-bottom: var(--space-6);
    overflow: hidden;
}

.activity-header {
    background: var(--gray-50);
    padding: var(--space-4) var(--space-5);
    border-bottom: var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.activity-title {
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--black);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

.activity-count {
    font-size: var(--text-xs);
    color: var(--gray-500);
    background: var(--gray-200);
    padding: var(--space-1) var(--space-2);
    border-radius: 10px;
    font-weight: 500;
}

.activity-content {
    max-height: 300px;
    overflow-y: auto;
}

.activity-item {
    display: flex;
    align-items: center;
    padding: var(--space-3) var(--space-5);
    border-bottom: 1px solid var(--gray-100);
}

.activity-item:last-child {
    border-bottom: none;
}

.item-avatar {
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    background: var(--primary);
    color: var(--black);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-xs);
    font-weight: 600;
    margin-right: var(--space-3);
    flex-shrink: 0;
}

.item-details {
    flex: 1;
    min-width: 0;
}

.item-name {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--black);
    margin: 0 0 var(--space-1) 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.item-meta {
    font-size: var(--text-xs);
    color: var(--gray-500);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

.item-status {
    font-size: var(--text-xs);
    font-weight: 600;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.item-action {
    padding: var(--space-1) var(--space-2);
    border: var(--border);
    border-radius: var(--radius);
    background: var(--white);
    color: var(--gray-600);
    font-size: var(--text-xs);
    text-decoration: none;
    flex-shrink: 0;
}

.item-action:hover {
    text-decoration: none;
}

/* Status Colors */
.status-pending { background: var(--warning-light); color: var(--warning); }
.status-approved { background: var(--primary-light); color: var(--primary-dark); }
.status-printed { background: var(--success-light); color: var(--success); }
.status-active { background: var(--success-light); color: var(--success); }
.status-expired { background: var(--danger-light); color: var(--danger); }
.status-lost { background: var(--danger-light); color: var(--danger); }
.status-damaged { background: var(--danger-light); color: var(--danger); }

/* Icon Colors */
.bg-primary { background: var(--primary); }
.bg-success { background: var(--success); }
.bg-warning { background: var(--warning); }
.bg-danger { background: var(--danger); }
.bg-info { background: var(--info); }
.bg-purple { background: #7c3aed; }

/* Empty State */
.empty-state {
    padding: var(--space-8) var(--space-5);
    text-align: center;
    color: var(--gray-500);
}

.empty-icon {
    font-size: 2rem;
    color: var(--gray-300);
    margin-bottom: var(--space-2);
}

.empty-text {
    font-size: var(--text-sm);
    margin: 0;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .stats-overview {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .actions-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .dashboard-container {
        padding: var(--space-4);
    }
    
    .stats-overview {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-3);
    }
    
    .actions-grid {
        grid-template-columns: 1fr;
        gap: var(--space-4);
    }
}

@media (max-width: 480px) {
    .stats-overview {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-center">
            <h1 class="page-title">
                <i class="bi bi-credit-card" style="color: var(--primary);"></i>
                ID Cards Management
            </h1>
            <p class="page-subtitle">Streamlined card management with real-time insights and quick actions</p>
        </div>
        <div class="header-actions">
            <a href="{% url 'cards:worker_id_card_create' %}" class="btn-compact btn-primary">
                <i class="bi bi-plus"></i>
                New Card
            </a>
            <a href="{% url 'cards:worker_id_card_batch_create' %}" class="btn-compact btn-outline">
                <i class="bi bi-stack"></i>
                Batch Create
            </a>
        </div>
    </div>

    <!-- Compact Statistics -->
    <div class="stats-overview">
        <div class="stat-card">
            <div class="stat-value">{{ worker_stats.total|default:0 }}</div>
            <div class="stat-label">Total Cards</div>
            <div class="stat-trend trend-up">
                <i class="bi bi-arrow-up"></i>
                +12 this week
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ worker_stats.active|default:0 }}</div>
            <div class="stat-label">Active</div>
            <div class="stat-trend trend-neutral">
                <i class="bi bi-dash"></i>
                Stable
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ worker_stats.pending|default:0 }}</div>
            <div class="stat-label">Pending</div>
            <div class="stat-trend trend-up">
                <i class="bi bi-arrow-up"></i>
                +3 today
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-value">{{ replacement_stats.total|default:0 }}</div>
            <div class="stat-label">Replacements</div>
            <div class="stat-trend trend-down">
                <i class="bi bi-arrow-down"></i>
                -2 this week
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ worker_stats.expired|default:0 }}</div>
            <div class="stat-label">Expired</div>
            <div class="stat-trend trend-up">
                <i class="bi bi-arrow-up"></i>
                Review needed
            </div>
        </div>
    </div>

    <!-- Quick Actions Grid -->
    <div class="actions-grid">
        <!-- Main Sections -->
        <a href="{% url 'cards:worker_id_card_list' 'all' %}" class="action-card featured-card">
            <div class="action-header">
                <div class="action-icon bg-primary">
                    <i class="bi bi-person-badge"></i>
                </div>
                <div class="action-title">Workers ID Cards</div>
            </div>
            <div class="action-desc">Manage employee identification cards and access control</div>
            <div class="action-meta">
                <i class="bi bi-people"></i>
                <span>{{ worker_stats.total|default:0 }} total • {{ worker_stats.active|default:0 }} active</span>
            </div>
        </a>



        <!-- Quick Actions -->
        <a href="{% url 'cards:worker_id_card_create' %}" class="action-card">
            <div class="action-header">
                <div class="action-icon bg-primary">
                    <i class="bi bi-plus-circle"></i>
                </div>
                <div class="action-title">Create New Card</div>
            </div>
            <div class="action-desc">Issue worker ID cards quickly with automated processing</div>
            <div class="action-meta">
                <i class="bi bi-lightning"></i>
                <span>Fast setup • 2 min avg</span>
            </div>
        </a>

        <a href="{% url 'cards:worker_id_card_batch_create' %}" class="action-card">
            <div class="action-header">
                <div class="action-icon bg-success">
                    <i class="bi bi-stack"></i>
                </div>
                <div class="action-title">Batch Operations</div>
            </div>
            <div class="action-desc">Process multiple cards efficiently with bulk operations</div>
            <div class="action-meta">
                <i class="bi bi-speedometer2"></i>
                <span>Bulk processing • Up to 50</span>
            </div>
        </a>



        <a href="{% url 'cards:card_replacement_list' %}" class="action-card">
            <div class="action-header">
                <div class="action-icon bg-purple">
                    <i class="bi bi-arrow-repeat"></i>
                </div>
                <div class="action-title">Replacements</div>
            </div>
            <div class="action-desc">Handle lost, damaged, and expired card replacements</div>
            <div class="action-meta">
                <i class="bi bi-exclamation-triangle"></i>
                <span>Priority queue • {{ replacement_stats.pending|default:0 }} pending</span>
            </div>
        </a>

        <a href="{% url 'cards:card_charges_list' %}" class="action-card">
            <div class="action-header">
                <div class="action-icon bg-danger">
                    <i class="bi bi-currency-dollar"></i>
                </div>
                <div class="action-title">Billing & Charges</div>
            </div>
            <div class="action-desc">Track costs, payments, and revenue analytics</div>
            <div class="action-meta">
                <i class="bi bi-graph-up"></i>
                <span>Revenue tracking • ${{ monthly_revenue|default:"0.00" }}</span>
            </div>
        </a>

        <a href="{% url 'cards:card_printing_history' %}" class="action-card">
            <div class="action-header">
                <div class="action-icon bg-info">
                    <i class="bi bi-clock-history"></i>
                </div>
                <div class="action-title">Printing History</div>
            </div>
            <div class="action-desc">Review print jobs, track history, and audit trails</div>
            <div class="action-meta">
                <i class="bi bi-archive"></i>
                <span>Audit trail • Complete records</span>
            </div>
        </a>
    </div>

    <!-- Activity Sections -->
    <div class="row">
        <div class="col-md-6">
            <div class="activity-section">
                <div class="activity-header">
                    <div class="activity-title">
                        <i class="bi bi-clock-history"></i>
                        Recent Worker Cards
                    </div>
                    <div class="activity-count">{{ recent_worker_cards|length|default:0 }}</div>
                </div>
                <div class="activity-content">
                    {% for card in recent_worker_cards %}
                        <div class="activity-item">
                            <div class="item-avatar">
                                {{ card.worker.get_full_name|first|upper|default:"?" }}
                            </div>
                            <div class="item-details">
                                <div class="item-name">{{ card.worker.get_full_name|default:"Unknown Worker" }}</div>
                                <div class="item-meta">
                                    <span class="item-status status-{{ card.status|default:'pending' }}">{{ card.get_status_display|default:'Pending' }}</span>
                                    <span>{{ card.created_at|timesince|default:"Recently" }} ago</span>
                                    {% if card.worker.building %}
                                        <span>{{ card.worker.building.name }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            <a href="{% url 'cards:worker_id_card_detail' card.pk %}" class="item-action">
                                <i class="bi bi-eye"></i>
                            </a>
                        </div>
                    {% empty %}
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="bi bi-inbox"></i>
                            </div>
                            <p class="empty-text">No recent worker cards</p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="col-md-6">
            
        </div>
    </div>

    <!-- Recent Replacements -->
    {% if recent_replacements %}
    <div class="activity-section">
        <div class="activity-header">
            <div class="activity-title">
                <i class="bi bi-arrow-repeat"></i>
                Recent Replacements
            </div>
            <div class="activity-count">{{ recent_replacements|length }}</div>
        </div>
        <div class="activity-content">
            {% for replacement in recent_replacements %}
                <div class="activity-item">
                    <div class="item-avatar bg-purple">
                        <i class="bi bi-arrow-repeat"></i>
                    </div>
                    <div class="item-details">
                        <div class="item-name">{{ replacement.card_holder_name }}</div>
                        <div class="item-meta">
                            <span class="item-status status-{{ replacement.status|default:'pending' }}">{{ replacement.get_status_display|default:'Pending' }}</span>
                            <span>{{ replacement.get_reason_display|default:'Replacement' }}</span>
                            <span>{{ replacement.created_at|timesince|default:"Recently" }} ago</span>
                        </div>
                    </div>
                    <a href="{% url 'cards:card_replacement_detail' replacement.pk %}" class="item-action">
                        <i class="bi bi-eye"></i>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('ID Cards Management Dashboard loaded successfully');
});
</script>
{% endblock %} 