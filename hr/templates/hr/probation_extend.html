{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-3">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'hr:probation_list' %}">Probation</a></li>
            <li class="breadcrumb-item"><a href="{% url 'hr:probation_detail' probation.pk %}">{{ probation.employee.full_name }}</a></li>
            <li class="breadcrumb-item active">Extend</li>
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">{{ title }}</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning alert-sm mb-3">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Note:</strong> Extending a probation period will update the status to "Extended" and add the specified days to the end date.
                    </div>

                    <div class="alert alert-info alert-sm mb-3">
                        <i class="bi bi-person me-2"></i>
                        <strong>Employee:</strong> {{ probation.employee.full_name }} ({{ probation.employee.employee_id }})
                    </div>

                    <form method="post">
                        {% csrf_token %}

                        <div class="mb-3">
                            <label for="extension_duration_days" class="form-label">Extension Duration (Days) <span class="text-danger">*</span></label>
                            <input type="number" name="extension_duration_days" id="extension_duration_days"
                                   class="form-control" min="1" max="365" value="30" required>
                            <small class="form-text text-muted">
                                Number of days to extend the probation period (typically 30, 60, or 90 days)
                            </small>
                        </div>

                        <div class="mb-3">
                            <label for="reason" class="form-label">Reason for Extension <span class="text-danger">*</span></label>
                            <textarea name="reason" id="reason" class="form-control" rows="6" required
                                      placeholder="Provide detailed reasons for extending the probation period..."></textarea>
                        </div>

                        <div class="bg-light p-3 rounded mb-3">
                            <h6 class="small mb-2">Period Information:</h6>
                            <div class="row small">
                                <div class="col-md-6">
                                    <strong>Start Date:</strong> {{ probation.start_date|date:"Y-m-d" }}
                                </div>
                                <div class="col-md-6">
                                    <strong>Current End Date:</strong> {{ probation.actual_end_date|default:probation.original_end_date|date:"Y-m-d" }}
                                </div>
                                <div class="col-md-6 mt-2">
                                    <strong>Current Status:</strong>
                                    {% if probation.status == 'active' %}
                                        <span class="badge bg-warning text-dark">Active</span>
                                    {% elif probation.status == 'extended' %}
                                        <span class="badge bg-info">Extended</span>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mt-2">
                                    <strong>New End Date:</strong> <span id="new-end-date" class="text-primary">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{% url 'hr:probation_detail' probation.pk %}" class="btn btn-secondary">
                                <i class="bi bi-arrow-left"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-warning">
                                <i class="bi bi-clock-history"></i> Extend Probation Period
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const extensionInput = document.getElementById('extension_duration_days');
    const newEndDateSpan = document.getElementById('new-end-date');

    function updateNewEndDate() {
        const days = parseInt(extensionInput.value) || 0;
        const currentEndDate = new Date('{{ probation.actual_end_date|default:probation.original_end_date|date:"Y-m-d" }}');
        const newEndDate = new Date(currentEndDate);
        newEndDate.setDate(newEndDate.getDate() + days);

        // Format the date as YYYY-MM-DD
        const formattedDate = newEndDate.toISOString().split('T')[0];
        newEndDateSpan.textContent = formattedDate;
    }

    // Update on page load
    updateNewEndDate();

    // Update on input change
    extensionInput.addEventListener('input', updateNewEndDate);
});
</script>
{% endblock %}
