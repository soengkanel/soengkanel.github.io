{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'ui/css/app.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
<style>
    /* Choices.js customization */
    .choices__inner {
        min-height: 38px;
        padding: 6px 8px;
        font-size: 14px;
        border-radius: 0.375rem;
        border: 1px solid #d1d5db;
    }
    .choices__inner:focus,
    .choices.is-focused .choices__inner {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .choices__list--dropdown .choices__item--selectable {
        padding: 8px 12px;
        font-size: 14px;
    }
    .choices__item--selectable.is-highlighted {
        background-color: #3b82f6;
    }
</style>
{% endblock %}

{% block content %}
<main class="min-h-screen h-auto">
    <div class="px-5 py-3">
        <!-- Page Header -->
        <div class="mb-4">
            <h2 class="text-lg font-semibold text-gray-900">{{ title }}</h2>
            <p class="text-sm text-gray-600 mt-1">Fill in the details below to create or update a job posting</p>
        </div>

        <!-- Form -->
        <form method="post" data-skip-enhancement>
            {% csrf_token %}

            <!-- Basic Information -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Basic Information</h2>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <!-- Job Title (Full Width) -->
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Job Title *</label>
                        <input type="text"
                               name="title"
                               id="title"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               value="{{ job.title|default:'' }}"
                               required
                               placeholder="e.g. Senior Software Engineer">
                    </div>

                    <!-- Department -->
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Department *</label>
                        <select name="department"
                                id="department-select"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                required>
                            <option value="">Select Department</option>
                            {% for dept in departments %}
                            <option value="{{ dept.id }}" {% if job.department_id == dept.id %}selected{% endif %}>
                                {{ dept.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Position -->
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Position *</label>
                        <select name="position"
                                id="position-select"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                required>
                            <option value="">Select Position</option>
                            {% for pos in positions %}
                            <option value="{{ pos.id }}" {% if job.position_id == pos.id %}selected{% endif %}>
                                {{ pos.title }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Employment Type -->
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Employment Type *</label>
                        <select name="employment_type"
                                id="employment_type"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                required>
                            <option value="Full-time" {% if job.employment_type == 'Full-time' %}selected{% endif %}>Full-time</option>
                            <option value="Part-time" {% if job.employment_type == 'Part-time' %}selected{% endif %}>Part-time</option>
                            <option value="Contract" {% if job.employment_type == 'Contract' %}selected{% endif %}>Contract</option>
                            <option value="Temporary" {% if job.employment_type == 'Temporary' %}selected{% endif %}>Temporary</option>
                            <option value="Internship" {% if job.employment_type == 'Internship' %}selected{% endif %}>Internship</option>
                        </select>
                    </div>

                    <!-- Number of Vacancies -->
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Number of Vacancies *</label>
                        <input type="number"
                               name="vacancies"
                               id="vacancies"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               value="{{ job.vacancies|default:1 }}"
                               min="1"
                               required>
                    </div>

                    <!-- Salary Range Min -->
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Salary Range Min (USD)</label>
                        <input type="number"
                               name="salary_range_min"
                               id="salary_range_min"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               value="{{ job.salary_range_min|default:'' }}"
                               step="0.01"
                               placeholder="Optional">
                        <p class="text-xs text-gray-500 mt-1">Minimum salary range for this position</p>
                    </div>

                    <!-- Salary Range Max -->
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Salary Range Max (USD)</label>
                        <input type="number"
                               name="salary_range_max"
                               id="salary_range_max"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               value="{{ job.salary_range_max|default:'' }}"
                               step="0.01"
                               placeholder="Optional">
                        <p class="text-xs text-gray-500 mt-1">Maximum salary range for this position</p>
                    </div>
                </div>
            </div>

            <!-- Job Details -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Job Details</h2>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <!-- Job Description -->
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Job Description *</label>
                        <textarea name="description"
                                  id="description"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  rows="4"
                                  required
                                  placeholder="Provide a comprehensive description of the job role">{{ job.description|default:'' }}</textarea>
                        <p class="text-xs text-gray-500 mt-1">Describe the role, responsibilities, and what makes it exciting</p>
                    </div>

                    <!-- Requirements -->
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Requirements *</label>
                        <textarea name="requirements"
                                  id="requirements"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  rows="4"
                                  required
                                  placeholder="List required qualifications, skills, and experience">{{ job.requirements|default:'' }}</textarea>
                        <p class="text-xs text-gray-500 mt-1">Required skills, experience, and qualifications</p>
                    </div>

                    <!-- Responsibilities -->
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Responsibilities</label>
                        <textarea name="responsibilities"
                                  id="responsibilities"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  rows="3"
                                  placeholder="Key responsibilities (optional)">{{ job.responsibilities|default:'' }}</textarea>
                    </div>

                    <!-- Qualifications -->
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Qualifications</label>
                        <textarea name="qualifications"
                                  id="qualifications"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  rows="3"
                                  placeholder="Educational qualifications (optional)">{{ job.qualifications|default:'' }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Status & Timeline -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Status & Timeline</h2>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <!-- Status -->
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status *</label>
                        <select name="status"
                                id="status"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                required>
                            <option value="draft" {% if job.status == 'draft' %}selected{% endif %}>Draft</option>
                            <option value="open" {% if job.status == 'open' %}selected{% endif %}>Open</option>
                            <option value="on_hold" {% if job.status == 'on_hold' %}selected{% endif %}>On Hold</option>
                            <option value="filled" {% if job.status == 'filled' %}selected{% endif %}>Filled</option>
                            <option value="cancelled" {% if job.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                        </select>
                    </div>

                    <!-- Posted Date -->
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Posted Date</label>
                        <input type="date"
                               name="posted_date"
                               id="posted_date"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               value="{{ job.posted_date|date:'Y-m-d'|default:'' }}">
                    </div>

                    <!-- Closing Date -->
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Closing Date</label>
                        <input type="date"
                               name="closing_date"
                               id="closing_date"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               value="{{ job.closing_date|date:'Y-m-d'|default:'' }}">
                        <p class="text-xs text-gray-500 mt-1">Last date for accepting applications</p>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex items-center justify-end space-x-3 mb-3">
                <a href="{% url 'recruitment:job_list' %}" class="button-min-danger">
                    Cancel
                </a>
                <button type="submit" class="button-min-primary px-4">
                    Save
                </button>
            </div>
        </form>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Choices.js for Department select
    const departmentSelect = document.getElementById('department-select');
    if (departmentSelect && departmentSelect.options.length > 10) {
        new Choices(departmentSelect, {
            searchEnabled: true,
            searchPlaceholderValue: 'Search department...',
            itemSelectText: 'Click to select',
            shouldSort: false,
            removeItemButton: false,
            noResultsText: 'No department found',
            noChoicesText: 'No departments available',
        });
    }

    // Initialize Choices.js for Position select
    const positionSelect = document.getElementById('position-select');
    if (positionSelect && positionSelect.options.length > 10) {
        new Choices(positionSelect, {
            searchEnabled: true,
            searchPlaceholderValue: 'Search position...',
            itemSelectText: 'Click to select',
            shouldSort: false,
            removeItemButton: false,
            noResultsText: 'No position found',
            noChoicesText: 'No positions available',
        });
    }
});
</script>
{% endblock %}
