<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Only run animations on article pages
        if (!document.querySelector('.article')) return;

        // Animate article header
        anime({
            targets: '.article-header',
            opacity: [0, 1],
            translateY: [-30, 0],
            duration: 800,
            easing: 'easeOutCubic'
        });

        // Animate article title
        anime({
            targets: '.article-title',
            opacity: [0, 1],
            translateY: [-20, 0],
            duration: 1000,
            delay: 200,
            easing: 'easeOutCubic'
        });

        // Animate tags
        anime({
            targets: '.article-tag',
            opacity: [0, 1],
            scale: [0.8, 1],
            duration: 600,
            delay: anime.stagger(100, { start: 400 }),
            easing: 'easeOutElastic(1, .8)'
        });

        // Animate content sections as they come into view
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.classList.contains('animated')) {
                    entry.target.classList.add('animated');

                    // Animate headings
                    if (entry.target.tagName.match(/^H[2-6]$/)) {
                        anime({
                            targets: entry.target,
                            opacity: [0, 1],
                            translateX: [-40, 0],
                            duration: 800,
                            easing: 'easeOutCubic'
                        });
                    }

                    // Animate paragraphs
                    if (entry.target.tagName === 'P') {
                        anime({
                            targets: entry.target,
                            opacity: [0, 1],
                            translateY: [20, 0],
                            duration: 600,
                            easing: 'easeOutCubic'
                        });
                    }

                    // Animate images
                    if (entry.target.tagName === 'IMG') {
                        anime({
                            targets: entry.target,
                            opacity: [0, 1],
                            scale: [0.95, 1],
                            duration: 1000,
                            easing: 'easeOutCubic'
                        });
                    }

                    // Animate lists
                    if (entry.target.tagName === 'UL' || entry.target.tagName === 'OL') {
                        const listItems = entry.target.querySelectorAll('li');
                        anime({
                            targets: listItems,
                            opacity: [0, 1],
                            translateX: [-20, 0],
                            duration: 600,
                            delay: anime.stagger(80),
                            easing: 'easeOutCubic'
                        });
                    }

                    // Animate tables
                    if (entry.target.tagName === 'TABLE') {
                        anime({
                            targets: entry.target,
                            opacity: [0, 1],
                            translateY: [30, 0],
                            duration: 800,
                            easing: 'easeOutCubic'
                        });
                    }

                    // Animate blockquotes
                    if (entry.target.tagName === 'BLOCKQUOTE') {
                        anime({
                            targets: entry.target,
                            opacity: [0, 1],
                            translateX: [-30, 0],
                            duration: 800,
                            easing: 'easeOutCubic'
                        });
                    }

                    // Animate code blocks
                    if (entry.target.tagName === 'PRE') {
                        anime({
                            targets: entry.target,
                            opacity: [0, 1],
                            scale: [0.98, 1],
                            duration: 700,
                            easing: 'easeOutCubic'
                        });
                    }
                }
            });
        }, observerOptions);

        // Observe all content elements
        const contentElements = document.querySelectorAll('.article-content > *');
        contentElements.forEach(el => {
            el.style.opacity = '0'; // Start hidden
            observer.observe(el);
        });

        // Animate reading progress bar
        const progressBar = document.getElementById('reading-progress');
        if (progressBar) {
            anime({
                targets: progressBar,
                scaleX: [0, 0],
                duration: 0
            });
        }

        // Add hover animations to navigation links
        const navLinks = document.querySelectorAll('.article-nav-link');
        navLinks.forEach(link => {
            link.addEventListener('mouseenter', function () {
                anime({
                    targets: this,
                    translateX: this.classList.contains('prev') ? -5 : 5,
                    duration: 300,
                    easing: 'easeOutCubic'
                });
            });

            link.addEventListener('mouseleave', function () {
                anime({
                    targets: this,
                    translateX: 0,
                    duration: 300,
                    easing: 'easeOutCubic'
                });
            });
        });
    });
</script>